<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mines Game</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold:          #f0c040;
  --gold-dim:      #c89a28;
  --neon-cyan:     #22d3ee;
  --neon-emerald:  #34d399;
  --neon-amber:    #fbbf24;
  --neon-rose:     #fb7185;
  --neon-blue:     #60a5fa;
  --bg-deep:       #0a0c14;
  --glass-bg:      rgba(18, 22, 40, 0.65);
  --glass-border:  rgba(255,255,255,0.11);
  --glass-border2: rgba(255,255,255,0.22);
  --text-primary:  #f0f0f5;
  --text-muted:    #9aa0b8;
  --radius:        16px;
  --radius-sm:     10px;
  --blur-main:     24px;
  --blur-modal:    30px;
  --blur-tile:     6px;
}
* { margin:0; padding:0; box-sizing:border-box; }
html, body {
  height:100%; min-height:100vh;
  font-family:'Rajdhani', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CANVAS BG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#bgCanvas {
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  z-index:0; pointer-events:none;
}

/* noise grain */
body::before {
  content:'';
  position:fixed; inset:0; z-index:1;
  pointer-events:none; opacity:.04;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size:200px 200px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.page-wrap {
  position:relative; z-index:2;
  min-height:100vh;
  display:flex; justify-content:center;
  align-items:flex-start;
  padding:28px 16px 48px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLASS CONTAINER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.container {
  background: var(--glass-bg);
  backdrop-filter: blur(var(--blur-main)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur-main)) saturate(1.4);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius);
  box-shadow: 0 8px 40px rgba(0,0,0,.52),
              inset 0 1px 0 rgba(255,255,255,.07);
  max-width:480px; width:100%;
  padding:28px 22px 32px;
  margin-top:20px;
}
.hidden { display:none !important; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TITLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.title {
  font-family:'Orbitron', sans-serif;
  font-size:50px; font-weight:900;
  letter-spacing:13px; text-align:center;
  margin-bottom:4px;
  background: linear-gradient(135deg, #f0c040 0%, #fbbf24 45%, #f59e0b 75%, #f0c040 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  filter: drop-shadow(0 0 20px rgba(240,192,64,.42));
  text-transform:uppercase;
}
.subtitle {
  font-size:14px; color:var(--text-muted);
  text-align:center; margin-bottom:24px;
  letter-spacing:2px; direction:rtl; font-weight:500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   USER INFO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.user-info {
  background: rgba(12,15,26,0.68);
  backdrop-filter: blur(10px);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius-sm);
  padding:12px 16px; margin-bottom:14px;
  display:flex; justify-content:space-between;
  align-items:center; gap:10px;
}
.user-name {
  font-family:'Orbitron', sans-serif;
  font-size:13px; font-weight:700;
  color:var(--gold); letter-spacing:1px; margin-bottom:2px;
  text-shadow: 0 0 8px rgba(240,192,64,.25);
}
.user-phone { font-size:13px; color:var(--text-muted); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INPUTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
input {
  width:100%; padding:14px 16px; margin:8px 0;
  background: rgba(12,15,26,0.78);
  border: 1.5px solid var(--glass-border2);
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:16px; font-weight:500;
  color:var(--text-primary); outline:none;
  transition: border-color .25s, box-shadow .25s;
}
input::placeholder { color:var(--text-muted); }
input:focus {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 14px rgba(34,211,238,.25);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
button {
  width:100%; padding:15px 18px; margin:7px 0;
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:17px; font-weight:700;
  letter-spacing:1.2px; cursor:pointer;
  border:none; position:relative; overflow:hidden;
  transition: transform .18s, box-shadow .25s, background .22s;
  text-transform:uppercase;
}
button:hover:not(:disabled) { transform:translateY(-2px); }
button:active:not(:disabled) { transform:translateY(0); }
button:disabled { opacity:.38; cursor:not-allowed; }

.btn-green {
  background: rgba(52,211,153,.18);
  border: 1.5px solid rgba(52,211,153,.55);
  color: var(--neon-emerald);
  box-shadow: 0 0 12px rgba(52,211,153,.18), inset 0 1px 0 rgba(52,211,153,.14);
}
.btn-green:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(52,211,153,.4);
  background: rgba(52,211,153,.26);
}
.btn-green:active:not(:disabled) { background: rgba(52,211,153,.34); }

.btn-orange {
  background: rgba(251,191,36,.15);
  border: 1.5px solid rgba(251,191,36,.5);
  color: var(--neon-amber);
  box-shadow: 0 0 12px rgba(251,191,36,.15);
}
.btn-orange:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(251,191,36,.35);
  background: rgba(251,191,36,.24);
}
.btn-orange:active:not(:disabled) { background: rgba(251,191,36,.32); }

.btn-blue {
  background: rgba(96,165,250,.17);
  border: 1.5px solid rgba(96,165,250,.5);
  color: var(--neon-blue);
  box-shadow: 0 0 12px rgba(96,165,250,.15);
}
.btn-blue:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(96,165,250,.35);
  background: rgba(96,165,250,.26);
}
.btn-blue:active:not(:disabled) { background: rgba(96,165,250,.34); }

.btn-red {
  background: rgba(251,113,133,.15);
  border: 1.5px solid rgba(251,113,133,.5);
  color: var(--neon-rose);
  box-shadow: 0 0 12px rgba(251,113,133,.15);
}
.btn-red:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(251,113,133,.35);
  background: rgba(251,113,133,.26);
}
.btn-red:active:not(:disabled) { background: rgba(251,113,133,.34); }

.btn-gold {
  background: linear-gradient(135deg, rgba(240,192,64,.27), rgba(251,191,36,.2));
  border: 1.5px solid rgba(240,192,64,.55);
  color: var(--gold);
  box-shadow: 0 0 14px rgba(240,192,64,.22);
}
.btn-gold:hover:not(:disabled) {
  box-shadow: 0 0 28px rgba(240,192,64,.44);
  background: linear-gradient(135deg, rgba(240,192,64,.36), rgba(251,191,36,.28));
}
.btn-gold:active:not(:disabled) {
  background: linear-gradient(135deg, rgba(240,192,64,.44), rgba(251,191,36,.36));
}

.btn-reset {
  background: rgba(96,165,250,.15);
  border: 1.5px solid rgba(96,165,250,.45);
  color: var(--neon-blue);
  box-shadow: 0 0 12px rgba(96,165,250,.13);
}
.btn-reset:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(96,165,250,.33);
  background: rgba(96,165,250,.24);
}
.btn-reset:active:not(:disabled) { background: rgba(96,165,250,.32); }

.logout-btn {
  width:auto; padding:9px 18px; margin:0;
  background: rgba(251,113,133,.14);
  border: 1.5px solid rgba(251,113,133,.45);
  color: var(--neon-rose);
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:14px; font-weight:600;
  letter-spacing:1px; cursor:pointer;
  transition: background .2s, box-shadow .2s;
  text-transform:uppercase;
}
.logout-btn:hover {
  background: rgba(251,113,133,.24);
  box-shadow: 0 0 18px rgba(251,113,133,.3);
}
.logout-btn:active { background: rgba(251,113,133,.32); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BALANCE BAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.balance-section {
  display:flex; justify-content:space-around; gap:12px;
  background: rgba(8,10,18,0.65);
  backdrop-filter: blur(12px);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius);
  padding:16px 12px; margin:16px 0;
}
.balance-item { text-align:center; flex:1; }
.balance-label {
  font-size:11px; color:var(--text-muted);
  letter-spacing:2.5px; text-transform:uppercase; margin-bottom:5px;
}
.balance-value {
  font-family:'Orbitron', sans-serif;
  font-size:22px; font-weight:700;
  color:var(--gold);
  text-shadow: 0 0 10px rgba(240,192,64,.45);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   5Ã—5 GAME GRID
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.grid {
  display:grid;
  grid-template-columns: repeat(5,1fr);
  gap:7px; margin:18px 0;
}
.tile {
  aspect-ratio:1;
  background: linear-gradient(150deg, rgba(28,34,56,0.82), rgba(18,22,40,0.94));
  backdrop-filter: blur(var(--blur-tile));
  border: 1.5px solid var(--glass-border2);
  border-radius:13px;
  display:flex; align-items:center; justify-content:center;
  font-size:26px; cursor:pointer;
  transition: transform .22s cubic-bezier(.34,1.56,.64,1),
              box-shadow .28s, background .25s, border-color .25s;
  position:relative; overflow:hidden; user-select:none;
}
.tile::before {
  content:'';
  position:absolute; top:0; left:8%; right:8%; height:1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.2), transparent);
  pointer-events:none;
}
.tile:hover:not(.revealed) {
  transform: scale(1.09);
  border-color: rgba(34,211,238,.6);
  box-shadow: 0 0 22px rgba(34,211,238,.32),
              inset 0 0 14px rgba(34,211,238,.08);
  background: linear-gradient(150deg, rgba(30,55,88,0.78), rgba(18,28,52,0.9));
}
.tile.revealed { cursor:default; }

.tile.safe {
  background: linear-gradient(150deg, rgba(240,192,64,.32), rgba(251,191,36,.16));
  border-color: rgba(240,192,64,.65);
  box-shadow: 0 0 18px rgba(240,192,64,.36),
              inset 0 0 10px rgba(240,192,64,.1);
  animation: tileIn .28s cubic-bezier(.34,1.56,.64,1);
}
.tile.mine {
  background: linear-gradient(150deg, rgba(251,113,133,.34), rgba(220,20,60,.18));
  border-color: rgba(251,113,133,.7);
  box-shadow: 0 0 20px rgba(251,60,80,.42),
              inset 0 0 12px rgba(251,60,80,.12);
  animation: tileIn .28s cubic-bezier(.34,1.56,.64,1);
}
.tile.mine-hit {
  animation: mineFlash .5s ease-out forwards;
}

@keyframes tileIn {
  0%   { transform:scale(.85); opacity:.6; }
  100% { transform:scale(1);   opacity:1;  }
}
@keyframes mineFlash {
  0%   { box-shadow: 0 0 52px rgba(251,60,80,1); transform:scale(1.12); }
  60%  { box-shadow: 0 0 28px rgba(251,60,80,.6); transform:scale(1);   }
  100% { box-shadow: 0 0 20px rgba(251,60,80,.42); transform:scale(1);  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MESSAGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.msg {
  padding:12px 16px; margin:12px 0;
  border-radius: var(--radius-sm);
  text-align:center; font-weight:600;
  font-size:15px; display:none;
  letter-spacing:.5px;
  backdrop-filter: blur(8px);
}
.msg.success {
  background: rgba(52,211,153,.16);
  border: 1.5px solid rgba(52,211,153,.45);
  color: var(--neon-emerald);
  text-shadow: 0 0 6px rgba(52,211,153,.3);
}
.msg.error {
  background: rgba(251,113,133,.16);
  border: 1.5px solid rgba(251,113,133,.45);
  color: var(--neon-rose);
  text-shadow: 0 0 6px rgba(251,113,133,.3);
}
.timer-msg {
  background: rgba(251,191,36,.14);
  border: 1.5px solid rgba(251,191,36,.4);
  color: var(--neon-amber);
  padding:10px 14px; border-radius: var(--radius-sm);
  margin:8px 0; text-align:center;
  font-size:14px; font-weight:500;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal {
  display:none; position:fixed; inset:0;
  background: rgba(4,5,10,0.74);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index:1000;
  justify-content:center; align-items:center;
  padding:20px;
}
.modal.active { display:flex; }

.modal-content {
  background: rgba(14,17,30,0.82);
  backdrop-filter: blur(var(--blur-modal)) saturate(1.35);
  -webkit-backdrop-filter: blur(var(--blur-modal)) saturate(1.35);
  border: 1.5px solid var(--glass-border2);
  box-shadow: 0 14px 52px rgba(0,0,0,.58),
              inset 0 1px 0 rgba(255,255,255,.08);
  padding:28px 24px;
  border-radius: var(--radius);
  max-width:420px; width:100%;
  max-height:90vh; overflow-y:auto;
}
.modal-title {
  font-family:'Orbitron', sans-serif;
  font-size:19px; font-weight:700;
  color:var(--gold); margin-bottom:18px;
  text-align:center; letter-spacing:2px;
  text-shadow: 0 0 12px rgba(240,192,64,.35);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME ACTION BUTTONS (NEW LAYOUT)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.game-action-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin: 18px 0;
}

.game-btn-left, .game-btn-right {
  padding: 15px 10px;
  border-radius: var(--radius-sm);
  font-family: 'Rajdhani', sans-serif;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 1.2px;
  cursor: pointer;
  border: none;
  position: relative;
  overflow: hidden;
  transition: transform .18s, box-shadow .25s, background .22s;
  text-transform: uppercase;
  text-align: center;
  width: 100%;
}

.game-btn-left:hover:not(:disabled),
.game-btn-right:hover:not(:disabled) {
  transform: translateY(-2px);
}

.game-btn-left:active:not(:disabled),
.game-btn-right:active:not(:disabled) {
  transform: translateY(0);
}

.game-btn-left:disabled,
.game-btn-right:disabled {
  opacity: .38;
  cursor: not-allowed;
}

/* Left side buttons (GREEN like Deposit) */
.game-btn-left {
  background: rgba(52,211,153,.18);
  border: 1.5px solid rgba(52,211,153,.55);
  color: var(--neon-emerald);
  box-shadow: 0 0 12px rgba(52,211,153,.18), inset 0 1px 0 rgba(52,211,153,.14);
}

.game-btn-left:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(52,211,153,.4);
  background: rgba(52,211,153,.26);
}

.game-btn-left:active:not(:disabled) {
  background: rgba(52,211,153,.34);
}

/* Right side buttons (ORANGE like Withdraw) */
.game-btn-right {
  background: rgba(251,191,36,.15);
  border: 1.5px solid rgba(251,191,36,.5);
  color: var(--neon-amber);
  box-shadow: 0 0 12px rgba(251,191,36,.15);
}

.game-btn-right:hover:not(:disabled) {
  box-shadow: 0 0 24px rgba(251,191,36,.35);
  background: rgba(251,191,36,.24);
}

.game-btn-right:active:not(:disabled) {
  background: rgba(251,191,36,.32);
}

/* Specific button styles within the grid */
#cashoutBtn { grid-column: 1; grid-row: 1; }
#resetBtn { grid-column: 1; grid-row: 2; }
#betBtn { grid-column: 2; grid-row: 1; }
#minesBtn { grid-column: 2; grid-row: 2; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KICKED OVERLAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.kicked-overlay {
  display:none; position:fixed; inset:0;
  background: rgba(3,4,8,0.95);
  backdrop-filter: blur(14px);
  z-index:9999;
  justify-content:center; align-items:center;
}
.kicked-overlay.active { display:flex; }

.kicked-box {
  background: rgba(14,17,30,0.9);
  backdrop-filter: blur(22px);
  border: 1.5px solid rgba(251,113,133,.35);
  box-shadow: 0 0 44px rgba(251,113,133,.18),
              0 14px 52px rgba(0,0,0,.58);
  padding:46px 36px; border-radius: var(--radius);
  text-align:center; max-width:360px; width:90%;
}
.kicked-box h2 {
  font-family:'Orbitron', sans-serif;
  color:var(--neon-rose); font-size:22px;
  margin-bottom:14px; letter-spacing:2px;
  text-shadow: 0 0 14px rgba(251,113,133,.5);
}
.kicked-box p {
  color:var(--text-muted); margin-bottom:22px;
  font-size:15px; line-height:1.55;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REQUEST TOGGLE (For Both Deposit/Withdraw)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.request-toggle {
  display:flex; gap:0; margin:14px 0 10px;
  background: rgba(8,10,18,0.6);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius-sm);
  overflow:hidden;
}
.request-toggle button {
  flex:1; margin:0; border-radius:0;
  padding:12px 8px; font-size:15px;
  background: transparent;
  border: none;
  box-shadow: none;
  color: var(--text-muted);
  transition: background .22s, color .22s, box-shadow .22s;
  text-transform:uppercase;
  letter-spacing:1px;
}
.request-toggle button:hover:not(:disabled) { transform:none; }
.request-toggle button.active-tab {
  background: rgba(52,211,153,.18);
  color: var(--neon-emerald);
  box-shadow: inset 0 0 12px rgba(52,211,153,.1);
}
.request-toggle button.active-tab.easy-active {
  background: rgba(251,191,36,.16);
  color: var(--neon-amber);
  box-shadow: inset 0 0 12px rgba(251,191,36,.1);
}
.request-toggle button + button {
  border-left: 1px solid var(--glass-border);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAYMENT NUMBER DISPLAY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.payment-number-display {
  background: rgba(8,10,18,0.65);
  border: 1.5px solid rgba(240,192,64,0.3);
  border-radius: 8px;
  padding: 16px;
  margin: 12px 0;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}
.payment-number-display:hover {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 20px rgba(34,211,238,0.2);
}
.payment-number-display .number {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px;
  font-weight: 700;
  color: var(--gold);
  letter-spacing: 2px;
  margin: 8px 0;
  text-shadow: 0 0 8px rgba(240,192,64,0.3);
}
.payment-number-display .urdu-msg {
  font-size: 14px;
  color: var(--neon-emerald);
  direction: rtl;
  margin-top: 8px;
  line-height: 1.5;
  white-space: pre-line;
}
.payment-number-display.copied {
  border-color: var(--neon-emerald);
  background: rgba(52,211,153,0.1);
}

/* JazzCash style */
.payment-number-display.jazzcash {
  border: 1.5px solid rgba(52,211,153,0.3);
}
.payment-number-display.jazzcash .number {
  color: var(--neon-emerald);
  text-shadow: 0 0 8px rgba(52,211,153,0.3);
}
.payment-number-display.jazzcash .urdu-msg {
  color: var(--neon-emerald);
}

/* Easypaisa style */
.payment-number-display.easypaisa {
  border: 1.5px solid rgba(251,191,36,0.3);
}
.payment-number-display.easypaisa .number {
  color: var(--neon-amber);
  text-shadow: 0 0 8px rgba(251,191,36,0.3);
}
.payment-number-display.easypaisa .urdu-msg {
  color: var(--neon-amber);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEPOSIT/WITHDRAW STATUS BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-row {
  display:flex; gap:8px; margin:12px 0;
}
.btn-row button {
  flex:1; margin:0;
}

.btn-amber {
  background: linear-gradient(135deg, rgba(251,191,36,0.24), rgba(251,191,36,0.14));
  border: 2px solid rgba(251,191,36,0.5);
  color: var(--neon-amber);
  box-shadow: 0 0 20px rgba(251,191,36,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
}
.btn-amber:hover:not(:disabled) {
  background: linear-gradient(135deg, rgba(251,191,36,0.34), rgba(251,191,36,0.24));
  box-shadow: 0 0 30px rgba(251,191,36,0.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PENDING REQUEST STATUS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pending-status {
  display:none;
  background: rgba(8,10,18,0.65);
  border: 1.5px solid rgba(240,192,64,0.3);
  border-radius: 8px;
  padding: 12px 16px;
  margin: 12px 0;
  text-align: center;
}
.pending-status.active {
  display:block;
  animation: fadeIn 0.3s ease;
}
.pending-amount {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--gold);
  margin: 8px 0;
}
.pending-method {
  font-size: 14px;
  color: var(--text-muted);
  margin-bottom: 8px;
}
.pending-timer {
  font-size: 13px;
  color: var(--neon-rose);
  direction: rtl;
  margin-top: 8px;
}

@keyframes fadeIn {
  from { opacity:0; transform:translateY(-10px); }
  to { opacity:1; transform:translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar       { width:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,.14); border-radius:3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:420px){
  .container      { padding:20px 14px 26px; }
  .title          { font-size:36px; letter-spacing:7px; }
  .balance-value  { font-size:18px; }
  .tile           { font-size:22px; }
  .modal-content  { padding:22px 16px; }
  .payment-number-display .number { font-size:17px; }
  .pending-amount { font-size:18px; }
  .game-btn-left, .game-btn-right { font-size:14px; padding:12px 8px; }
  .payment-number-display .urdu-msg { font-size: 12px; }
}
</style>
</head>
<body>

<!-- â•â•â• PARTICLE CANVAS â•â•â• -->
<canvas id="bgCanvas"></canvas>

<div class="page-wrap">

<!-- â•â•â• KICKED OVERLAY â•â•â• -->
<div id="kickedOverlay" class="kicked-overlay">
  <div class="kicked-box">
    <div style="font-size:50px; margin-bottom:12px;">ğŸš«</div>
    <h2>SESSION TERMINATED</h2>
  </div>
</div>

<!-- â•â•â• LOGIN SCREEN â•â•â• -->
<div id="loginScreen" class="container">
  <div class="title">MINES</div>
  <div class="subtitle">Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø§ÙˆØ± Ù†Ù…Ø¨Ø± Ù„Ú©Ú¾ÛŒÚº</div>
  <div id="loginMsg" class="msg"></div>
  <input type="text"  id="loginName"  placeholder="Your Name"   maxlength="50">
  <input type="tel"   id="loginPhone" placeholder="03XXXXXXXXX" maxlength="11">
  <button class="btn-green" onclick="handleLogin()">LOGIN / Ù„Ø§Ú¯ Ø§Ù†</button>
</div>

<!-- â•â•â• GAME SCREEN â•â•â• -->
<div id="gameScreen" class="container hidden">
  <div class="user-info">
    <div>
      <div class="user-name"  id="displayName"></div>
      <div class="user-phone" id="displayPhone"></div>
    </div>
    <button class="logout-btn" onclick="handleLogout()">Logout</button>
  </div>

  <div class="title">MINES</div>
  <div id="gameMsg" class="msg"></div>

  <!-- Deposit/Withdraw Button Row -->
  <div class="btn-row">
    <!-- Deposit Button -->
    <button class="btn-green" id="depositBtn" onclick="openDepositModal()">DEPOSIT</button>
    <!-- Withdraw Button -->
    <button class="btn-orange" id="withdrawBtn" onclick="openWithdrawModal()">WITHDRAW</button>
  </div>

  <!-- Pending Deposit Status -->
  <div id="pendingDepositStatus" class="pending-status">
    <div style="color:var(--neon-emerald); font-weight:600; margin-bottom:6px;">â³ Deposit Pending</div>
    <div class="pending-amount" id="pendingDepositAmount">Rs 0</div>
    <div class="pending-method" id="pendingDepositMethod"></div>
    <div class="pending-timer" id="depositLockTimer"></div>
  </div>

  <!-- Pending Withdraw Status -->
  <div id="pendingWithdrawStatus" class="pending-status">
    <div style="color:var(--neon-amber); font-weight:600; margin-bottom:6px;">â³ Withdraw Pending</div>
    <div class="pending-amount" id="pendingWithdrawAmount">Rs 0</div>
    <div class="pending-method" id="pendingWithdrawMethod"></div>
    <div style="font-size:13px; color:var(--text-muted);" id="pendingWithdrawNumber"></div>
  </div>

  <div class="balance-section">
    <div class="balance-item">
      <div class="balance-label">Balance</div>
      <div class="balance-value">Rs <span id="balance">0</span></div>
    </div>
    <div class="balance-item">
      <div class="balance-label">Current Win</div>
      <div class="balance-value">Rs <span id="win">0</span></div>
    </div>
  </div>

  <div class="grid" id="gameGrid"></div>

  <!-- NEW GAME ACTION BUTTONS LAYOUT -->
  <div class="game-action-buttons">
    <!-- Left side - Green buttons -->
    <button class="game-btn-left" id="cashoutBtn" onclick="cashout()" disabled>CASHOUT</button>
    <button class="game-btn-left" id="resetBtn" onclick="resetGame()">RESET</button>
    
    <!-- Right side - Orange buttons -->
    <button class="game-btn-right" id="betBtn" onclick="openBetModal()">BET RS <span id="betDisplay">0</span></button>
    <button class="game-btn-right" id="minesBtn" onclick="openMinesModal()">ğŸ’£ MINES: <span id="minesDisplay">3</span></button>
  </div>
</div>

</div><!-- /page-wrap -->

<!-- â•â•â• DEPOSIT MODAL (Mirror of Withdraw Modal) â•â•â• -->
<div id="depositModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">Deposit Request</div>
    
    <!-- Payment Method Toggle (Same as Withdraw) -->
    <div class="request-toggle">
      <button id="depTabJazz" class="active-tab" onclick="switchDepositMethod('jazzcash')">JazzCash</button>
      <button id="depTabEasy" onclick="switchDepositMethod('easypaisa')">Easypaisa</button>
    </div>
    
    <!-- Payment Number Display (Non-editable, Copy Only) -->
    <div class="payment-number-display jazzcash" id="depositNumberDisplay" onclick="copyDepositNumber()">
      <div class="number" id="depositNumber">03266916283</div>
      <div class="urdu-msg" id="depositInstruction">
JazzCash Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û:
Ø§ÙˆÙ¾Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ú©Ø§ Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº ÛŒØ§ Download Ú©Ø±ÛŒÚºÛ”
JazzCash Ø§ÛŒÙ¾ Ú©Ú¾ÙˆÙ„ÛŒÚº Ø§ÙˆØ± Ø¨Ø§Ù„Ú©Ù„ Ù†ÛŒÚ†Û’ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø±Ù…ÛŒØ§Ù†ÛŒ Ù„Ø§Ù„ Ø¨Ù¹Ù† Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”
Ø§Ø³ Ú©Û’ Ø¨Ø¹Ø¯ Enter Till ID Ú©ÛŒ Ø¨Ø§Ø¦ÛŒÚº Ø·Ø±Ù Ø¨Ù¹Ù† Ú©Ù„Ú© Ú©Ø± Ú©Û’ Download Ú©ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ø³ÛŒÙ†Úˆ Ú©Ø±ÛŒÚºÛ”
JazzCash Ù…ÛŒÚº Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±ÛŒÚº 500 ÛŒØ§ Ø§Ø³ Ø³Û’ Ø²ÛŒØ§Ø¯ÛÛ”
Ø±Ù‚Ù… Ø¨Ú¾ÛŒØ¬Ù†Û’ Ú©Û’ Ø¨Ø¹Ø¯ Ù†ÛŒÚ†Û’ Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Submit Request Ø¨Ù¹Ù† Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”
Ø¬Ùˆ Ø±Ù‚Ù… Ø¢Ù¾ Ù†Û’ Ø¨Ú¾ÛŒØ¬ÛŒ ÛÙˆ Ú¯ÛŒ ØªØµØ¯ÛŒÙ‚ Ú©Û’ Ø¨Ø¹Ø¯ Ø¢Ù¾ Ú©Û’ Ø¨ÛŒÙ„Ù†Ø³ Ù…ÛŒÚº Ø¬Ù…Ø¹ Ú©Ø± Ø¯ÛŒ Ø¬Ø§Ø¦Û’ Ú¯ÛŒÛ”
Ø´Ú©Ø±ÛŒÛÛ”
      </div>
    </div>
    
    <!-- Amount Input -->
    <input type="number" id="depositAmount" placeholder="Amount (Minimum Rs 500)" min="500">
    
    <!-- Cooldown Message -->
    <div id="depositCooldown" style="display:none;" class="timer-msg"></div>
    
    <!-- Submit Button -->
    <button class="btn-orange" onclick="submitDeposit()">Submit Request</button>
    <button class="btn-red" onclick="closeModal('depositModal')">Cancel</button>
  </div>
</div>

<!-- â•â•â• WITHDRAW MODAL â•â•â• -->
<div id="withdrawModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">Withdraw Request</div>
    
    <!-- Payment Method Toggle -->
    <div class="request-toggle">
      <button id="tabJazz" class="active-tab" onclick="switchWithdrawMethod('jazz')">JazzCash</button>
      <button id="tabEasy" onclick="switchWithdrawMethod('easy')">Easypaisa</button>
    </div>
    
    <!-- Phone Input -->
    <input type="tel" id="withdrawPhone" placeholder="03XXXXXXXXX" maxlength="11">
    
    <!-- Amount Input -->
    <input type="number" id="withdrawAmount" placeholder="Amount (Minimum Rs 1000)" min="1000">
    
    <!-- Cooldown Message -->
    <div id="withdrawCooldown" style="display:none;" class="timer-msg"></div>
    
    <!-- Submit Button -->
    <button class="btn-orange" onclick="submitWithdraw()">Submit Request</button>
    <button class="btn-red" onclick="closeModal('withdrawModal')">Cancel</button>
  </div>
</div>

<!-- â•â•â• BET MODAL â•â•â• -->
<div id="betModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">Set Bet Amount</div>
    <input type="number" id="betInput" placeholder="Amount (Rs 100 â€“ 10,000)" min="100" max="10000">
    <button class="btn-blue" onclick="setBet()">Set Bet</button>
    <button class="btn-red"  onclick="closeModal('betModal')">Cancel</button>
  </div>
</div>

<!-- â•â•â• MINES MODAL â•â•â• -->
<div id="minesModal" class="modal">
  <div class="modal-content">
    <div class="modal-title">ğŸ’£ Set Mines Count</div>
    <input type="number" id="minesInput" placeholder="Mines (1â€“24)" min="1" max="24" value="3">
    <button class="btn-red"  onclick="setMines()">Set Mines</button>
    <button class="btn-blue" onclick="closeModal('minesModal')">Cancel</button>
  </div>
</div>

<!-- â•â•â• ADAPTIVE PERFORMANCE â•â•â• -->
<script>
(function(){
  const cores  = navigator.hardwareConcurrency || 4;
  const dpr    = window.devicePixelRatio || 1;
  const w      = screen.width;
  const isLow  = cores <= 2 || (dpr >= 3 && w < 400) || (w < 320);
  window._perfTier = isLow ? 'low' : 'high';
  if(isLow){
    document.documentElement.style.setProperty('--blur-main',  '14px');
    document.documentElement.style.setProperty('--blur-modal', '18px');
    document.documentElement.style.setProperty('--blur-tile',  '3px');
  }
})();
</script>

<!-- â•â•â• BACKGROUND PARTICLE ENGINE â•â•â• -->
<script>
(function(){
  const canvas = document.getElementById('bgCanvas');
  const ctx    = canvas.getContext('2d');
  let W, H;
  function resize(){
    W = canvas.width  = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }
  window.addEventListener('resize', resize);
  resize();

  const isLow       = window._perfTier === 'low';
  const PART_COUNT  = isLow ? 55  : 120;
  const SHARD_COUNT = isLow ? 8   : 20;

  const PALETTE = [
    [34,211,238],[96,165,250],[52,211,153],
    [240,192,64],[251,191,36],[180,195,240],
  ];

  class Particle {
    constructor(){ this.reset(true); }
    reset(init){
      this.x  = init ? Math.random()*W : (Math.random()<.5 ? -12 : W+12);
      this.y  = init ? Math.random()*H : Math.random()*H;
      this.r  = .5 + Math.random()*2.4;
      this.vx = (Math.random()-.5)*.38;
      this.vy = (Math.random()-.5)*.38;
      this.col   = PALETTE[Math.floor(Math.random()*PALETTE.length)];
      this.alpha = .12 + Math.random()*.5;
      this.phase = Math.random()*Math.PI*2;
      this.freq  = .35 + Math.random()*.55;
    }
    update(){
      this.x+=this.vx; this.y+=this.vy; this.phase+=this.freq*.016;
      if(this.x<-30||this.x>W+30||this.y<-30||this.y>H+30) this.reset(false);
    }
    draw(){
      const a = this.alpha + Math.sin(this.phase)*.13;
      const [r,g,b] = this.col;
      ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
      ctx.fillStyle = `rgba(${r},${g},${b},${a})`; ctx.fill();
      if(!isLow){
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r*3.5, 0, Math.PI*2);
        ctx.fillStyle = `rgba(${r},${g},${b},${a*.16})`; ctx.fill();
      }
    }
  }

  class Shard {
    constructor(){ this.reset(true); }
    reset(init){
      this.x     = init ? Math.random()*W : -70;
      this.y     = init ? Math.random()*H : Math.random()*H;
      this.w     = 2.5 + Math.random()*4;
      this.h     = 28 + Math.random()*75;
      this.angle = -.52 + Math.random()*.25;
      this.speed = .28 + Math.random()*.32;
      this.alpha = .028 + Math.random()*.065;
      this.col   = [195+Math.random()*60, 210+Math.random()*45, 255];
    }
    update(){ this.x += this.speed; if(this.x > W+100) this.reset(false); }
    draw(){
      ctx.save();
      ctx.translate(this.x, this.y);
      ctx.rotate(this.angle);
      const g = ctx.createLinearGradient(0,0,0,this.h);
      const [r,gr,b] = this.col;
      g.addColorStop(0,   `rgba(${r},${gr},${b},0)`);
      g.addColorStop(.28, `rgba(${r},${gr},${b},${this.alpha})`);
      g.addColorStop(.72, `rgba(${r},${gr},${b},${this.alpha})`);
      g.addColorStop(1,   `rgba(${r},${gr},${b},0)`);
      ctx.fillStyle = g;
      ctx.fillRect(-this.w*.5, 0, this.w, this.h);
      ctx.restore();
    }
  }

  const particles = [], shards = [];
  for(let i=0; i<PART_COUNT; i++) particles.push(new Particle());
  for(let i=0; i<SHARD_COUNT; i++) shards.push(new Shard());

  function drawBg(){
    const g = ctx.createLinearGradient(0,0, W*.55, H);
    g.addColorStop(0,   '#0a0c14');
    g.addColorStop(.4,  '#0e1320');
    g.addColorStop(.72, '#111a2e');
    g.addColorStop(1,   '#0c1118');
    ctx.fillStyle = g;
    ctx.fillRect(0,0,W,H);
    if(!isLow){
      [
        { x:W*.12, y:H*.28, r:W*.24, c:'rgba(34,211,238,.032)' },
        { x:W*.82, y:H*.68, r:W*.21, c:'rgba(96,165,250,.028)' },
        { x:W*.48, y:H*.88, r:W*.19, c:'rgba(52,211,153,.022)' },
        { x:W*.72, y:H*.12, r:W*.17, c:'rgba(240,192,64,.020)' },
        { x:W*.25, y:H*.75, r:W*.15, c:'rgba(251,191,36,.018)' },
      ].forEach(b=>{
        const rg = ctx.createRadialGradient(b.x,b.y,0, b.x,b.y,b.r);
        rg.addColorStop(0, b.c);
        rg.addColorStop(1, 'transparent');
        ctx.fillStyle = rg;
        ctx.fillRect(0,0,W,H);
      });
    }
  }

  function loop(){
    drawBg();
    shards.forEach(s=>{ s.update(); s.draw(); });
    particles.forEach(p=>{ p.update(); p.draw(); });
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>

<!-- â•â•â• FIREBASE MODULE â•â•â• -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import { getDatabase, ref, set, get, update, onValue, push, serverTimestamp }
  from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

const firebaseConfig = {
  apiKey:"AIzaSyA8C1-TpsRo0UsATshlI8Dy0v40PnLRlc4",
  authDomain:"mines-67d8c.firebaseapp.com",
  databaseURL:"https://mines-67d8c-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"mines-67d8c",
  storageBucket:"mines-67d8c.firebasestorage.app",
  messagingSenderId:"918317634273",
  appId:"1:918317634273:web:8527c0d58a1f3de0371da0",
  measurementId:"G-NHC6K1X3KZ"
};

const app      = initializeApp(firebaseConfig);
const database = getDatabase(app);

window.db               = database;
window.dbRef            = ref;
window.dbSet            = set;
window.dbGet            = get;
window.dbUpdate         = update;
window.dbOnValue        = onValue;
window.dbPush           = push;
window.dbServerTimestamp = serverTimestamp;

if (window._fbResolve) window._fbResolve();
console.log('âœ… Firebase initialized successfully!');
</script>

<!-- â•â•â• MAIN GAME SCRIPT â•â•â• -->
<script>
window._fbReady = new Promise(r => { window._fbResolve = r; });
async function fbReady(){ await window._fbReady; }

/* â”€â”€â”€ Device fingerprint â”€â”€â”€ */
function getDeviceFingerprint(){
  const n=navigator, s=window.screen;
  return btoa(`${n.userAgent}_${s.width}x${s.height}_${s.colorDepth}_${n.language}`).substring(0,32);
}

/* â”€â”€â”€ Game State â”€â”€â”€ */
let gameState = {
  userId:null, userName:'', userPhone:'',
  balance:0, currentBet:0, currentWin:0,
  minesCount:3, gameActive:false,
  minePositions:[], revealedTiles:[],
  betSet:false, tilesClicked:false
};

/* â”€â”€â”€ Sound Effects â”€â”€â”€ */
const sounds = {
  click: new Audio('data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU4AAAB/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/'),
  success: new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YWAAAAB/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/gH+Af4B/'),
  error: new Audio('data:audio/wav;base64,UklGRh4AAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YVoAAACAf39/gICAf39/gIB/f39/f4CAf39/gH+Af4B/gH+Af39/f3+Af4B/gH+Af39/'),
  win: new Audio('data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YW4AAAB/gICAgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpI='),
  mine: new Audio('data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YWIAAACAfn5eXn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+fn5+')
};

// Preload sounds - set to 40% volume
Object.values(sounds).forEach(sound => {
  sound.volume = 0.4;
  sound.load();
});

// Audio context for musical sounds
let audioCtx;

function initAudioContext(){
  if(!audioCtx){
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e) {
      console.log('Audio context init failed:', e);
    }
  }
}

// Play button click music
function playButtonMusic(){
  if(!audioCtx) initAudioContext();
  if(!audioCtx) return;
  
  try {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    osc.type = 'sine';
    osc.frequency.value = 800;
    gain.gain.value = 0.16; // 40% volume
    
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    osc.start();
    osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
    osc.stop(audioCtx.currentTime + 0.1);
  } catch(e) {
    console.log('Button music error:', e);
  }
}

// Play musical note on tile click/reveal
function playMusicNote(frequency, duration = 0.15){
  if(!audioCtx) initAudioContext();
  if(!audioCtx) return;
  
  try {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    osc.type = 'sine';
    osc.frequency.value = frequency;
    gain.gain.value = 0.16; // 40% volume
    
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    osc.start();
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    osc.stop(audioCtx.currentTime + duration);
  } catch(e) {
    console.log('Music note error:', e);
  }
}

// Play realistic bomb blast sound
function playBombBlast(){
  if(!audioCtx) initAudioContext();
  if(!audioCtx) return;
  
  try {
    // Create multiple layers for realistic bomb blast
    
    // Layer 1: Low frequency rumble
    const osc1 = audioCtx.createOscillator();
    const gain1 = audioCtx.createGain();
    osc1.type = 'sawtooth';
    osc1.frequency.value = 80;
    gain1.gain.value = 0.2; // 40% volume
    osc1.connect(gain1);
    gain1.connect(audioCtx.destination);
    
    // Layer 2: Mid explosion crack
    const osc2 = audioCtx.createOscillator();
    const gain2 = audioCtx.createGain();
    osc2.type = 'square';
    osc2.frequency.value = 200;
    gain2.gain.value = 0.12; // 40% volume
    osc2.connect(gain2);
    gain2.connect(audioCtx.destination);
    
    // Layer 3: High frequency debris
    const noise = audioCtx.createBufferSource();
    const noiseGain = audioCtx.createGain();
    const noiseFilter = audioCtx.createBiquadFilter();
    
    // Create white noise
    const bufferSize = audioCtx.sampleRate * 0.5;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for(let i = 0; i < bufferSize; i++){
      data[i] = Math.random() * 2 - 1;
    }
    noise.buffer = buffer;
    
    noiseFilter.type = 'bandpass';
    noiseFilter.frequency.value = 1000;
    noiseGain.gain.value = 0.08; // 40% volume
    
    noise.connect(noiseFilter);
    noiseFilter.connect(noiseGain);
    noiseGain.connect(audioCtx.destination);
    
    // Start all layers
    const now = audioCtx.currentTime;
    osc1.start(now);
    osc2.start(now);
    noise.start(now);
    
    // Decay envelopes
    osc1.frequency.exponentialRampToValueAtTime(20, now + 0.5);
    gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
    
    osc2.frequency.exponentialRampToValueAtTime(50, now + 0.3);
    gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
    
    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);
    
    // Stop all
    osc1.stop(now + 0.5);
    osc2.stop(now + 0.3);
    noise.stop(now + 0.4);
    
  } catch(e) {
    console.log('Bomb blast sound error:', e);
  }
}

function playSound(soundName){
  try {
    if(!audioCtx) initAudioContext();
    
    if(sounds[soundName]){
      sounds[soundName].currentTime = 0;
      sounds[soundName].volume = 0.4; // Ensure 40% volume
      sounds[soundName].play().catch(e => console.log('Sound blocked:', e));
    }
  } catch(e) {
    console.log('Sound error:', e);
  }
}

/* â”€â”€â”€ Win-rate table â”€â”€â”€ */
const WIN_RATES = {
   1:0.02, 2:0.05, 3:0.10, 4:0.20, 5:0.40,
   6:0.60, 7:0.70, 8:0.80, 9:0.90, 10:1.00,
  11:1.10,12:1.20,13:1.30,14:1.40,15:1.50,
  16:1.60,17:1.70,18:1.80,19:1.90,20:2.00,
  21:2.20,22:2.50,23:3.00,24:4.00,
};
function getWinRate(){ return WIN_RATES[gameState.minesCount] || 0.10; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEPOSIT SYSTEM (Mirror of Withdraw System)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let depositMethod = 'jazzcash';
let depositLockTimer = null;

// Deposit method switching
function switchDepositMethod(method){
  playButtonMusic();
  depositMethod = method;
  const tabJ = document.getElementById('depTabJazz');
  const tabE = document.getElementById('depTabEasy');
  const numberEl = document.getElementById('depositNumber');
  const displayEl = document.getElementById('depositNumberDisplay');
  const instructionEl = document.getElementById('depositInstruction');
  
  if(method === 'jazzcash'){
    tabJ.classList.add('active-tab');
    tabJ.classList.remove('easy-active');
    tabE.classList.remove('active-tab','easy-active');
    numberEl.textContent = '03266916283';
    displayEl.className = 'payment-number-display jazzcash';
    instructionEl.textContent = 'JazzCash Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û:\nØ§ÙˆÙ¾Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ú©Ø§ Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº ÛŒØ§ Download Ú©Ø±ÛŒÚºÛ”\nJazzCash Ø§ÛŒÙ¾ Ú©Ú¾ÙˆÙ„ÛŒÚº Ø§ÙˆØ± Ø¨Ø§Ù„Ú©Ù„ Ù†ÛŒÚ†Û’ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø±Ù…ÛŒØ§Ù†ÛŒ Ù„Ø§Ù„ Ø¨Ù¹Ù† Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”\nØ§Ø³ Ú©Û’ Ø¨Ø¹Ø¯ Enter Till ID Ú©ÛŒ Ø¨Ø§Ø¦ÛŒÚº Ø·Ø±Ù Ø¨Ù¹Ù† Ú©Ù„Ú© Ú©Ø± Ú©Û’ Download Ú©ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ø³ÛŒÙ†Úˆ Ú©Ø±ÛŒÚºÛ”\nJazzCash Ù…ÛŒÚº Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±ÛŒÚº 500 ÛŒØ§ Ø§Ø³ Ø³Û’ Ø²ÛŒØ§Ø¯ÛÛ”\nØ±Ù‚Ù… Ø¨Ú¾ÛŒØ¬Ù†Û’ Ú©Û’ Ø¨Ø¹Ø¯ Ù†ÛŒÚ†Û’ Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Submit Request Ø¨Ù¹Ù† Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”\nØ¬Ùˆ Ø±Ù‚Ù… Ø¢Ù¾ Ù†Û’ Ø¨Ú¾ÛŒØ¬ÛŒ ÛÙˆ Ú¯ÛŒ ØªØµØ¯ÛŒÙ‚ Ú©Û’ Ø¨Ø¹Ø¯ Ø¢Ù¾ Ú©Û’ Ø¨ÛŒÙ„Ù†Ø³ Ù…ÛŒÚº Ø¬Ù…Ø¹ Ú©Ø± Ø¯ÛŒ Ø¬Ø§Ø¦Û’ Ú¯ÛŒÛ”\nØ´Ú©Ø±ÛŒÛÛ”';
  } else {
    tabE.classList.add('active-tab','easy-active');
    tabJ.classList.remove('active-tab');
    numberEl.textContent = '03193433587';
    displayEl.className = 'payment-number-display easypaisa';
    instructionEl.textContent = 'Easypaisa Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø±Ù‚Ù… Ø¨Ú¾ÛŒØ¬Ù†Û’ Ú©Ø§ Ø·Ø±ÛŒÙ‚Û:\nØ§ÙˆÙ¾Ø± Ø¯ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ú©Ø§ Ø³Ú©Ø±ÛŒÙ† Ø´Ø§Ù¹ Ù„ÛŒÚº ÛŒØ§ Download Ú©Ø±ÛŒÚºÛ”\nEasypaisa Ø§ÛŒÙ¾ Ú©Ú¾ÙˆÙ„ÛŒÚº Ø§ÙˆØ± Ø¨Ø§Ù„Ú©Ù„ Ù†ÛŒÚ†Û’ Ù…ÙˆØ¬ÙˆØ¯ Ø¯Ø±Ù…ÛŒØ§Ù†ÛŒ Ø³Ø¨Ø² Ø¨Ù¹Ù† Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”\nØ§Ø³ Ú©Û’ Ø¨Ø¹Ø¯ Scan from Gallery Ù¾Ø± Ú©Ù„Ú© Ú©Ø± Ú©Û’ Download Ú©ÛŒ Ú¯Ø¦ÛŒ ØªØµÙˆÛŒØ± Ø³ÛŒÙ†Úˆ Ú©Ø±ÛŒÚºÛ”\nEasypaisa Ù…ÛŒÚº Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Ø§ÙˆØ± Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©Ø±ÛŒÚº 500 ÛŒØ§ Ø§Ø³ Ø³Û’ Ø²ÛŒØ§Ø¯ÛÛ”\nØ±Ù‚Ù… Ø¨Ú¾ÛŒØ¬Ù†Û’ Ú©Û’ Ø¨Ø¹Ø¯ Ù†ÛŒÚ†Û’ Ø§Ù…Ø§ÙˆÙ†Ù¹ Ù„Ú©Ú¾ÛŒÚº Submit Request Ø¨Ù¹Ù† Ú©Ù„Ú© Ú©Ø±ÛŒÚºÛ”\nØ¬Ùˆ Ø±Ù‚Ù… Ø¢Ù¾ Ù†Û’ Ø¨Ú¾ÛŒØ¬ÛŒ ÛÙˆ Ú¯ÛŒ ØªØµØ¯ÛŒÙ‚ Ú©Û’ Ø¨Ø¹Ø¯ Ø¢Ù¾ Ú©Û’ Ø¨ÛŒÙ„Ù†Ø³ Ù…ÛŒÚº Ø¬Ù…Ø¹ Ú©Ø± Ø¯ÛŒ Ø¬Ø§Ø¦Û’ Ú¯ÛŒÛ”\nØ´Ú©Ø±ÛŒÛÛ”';
  }
}

// Copy deposit number to clipboard
function copyDepositNumber(){
  const number = document.getElementById('depositNumber').textContent;
  const display = document.getElementById('depositNumberDisplay');
  
  if(navigator.clipboard){
    navigator.clipboard.writeText(number).then(() => {
      display.classList.add('copied');
      setTimeout(() => display.classList.remove('copied'), 2000);
      playSound('success');
      playButtonMusic();
    }).catch(err => {
      console.error('Copy failed:', err);
    });
  } else {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = number;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    
    display.classList.add('copied');
    setTimeout(() => display.classList.remove('copied'), 2000);
    playSound('success');
  }
}

// Check deposit lock status
async function checkDepositLock(){
  try {
    const userSnap = await window.dbGet(window.dbRef(window.db, `users/${gameState.userPhone}`));
    if(!userSnap.exists()) return { locked: false };
    
    const user = userSnap.val();
    const rejections = user.depositRejections || 0;
    const lockUntil = user.depositLockUntil || 0;
    const now = Date.now();
    
    if(rejections >= 3 && now < lockUntil){
      return { 
        locked: true, 
        lockUntil: lockUntil, 
        remaining: Math.ceil((lockUntil - now) / 1000) 
      };
    }
    
    if(rejections >= 3 && now >= lockUntil){
      await window.dbUpdate(window.dbRef(window.db, `users/${gameState.userPhone}`), {
        depositRejections: 0,
        depositLockUntil: null
      });
      return { locked: false, reset: true };
    }
    
    return { locked: false };
  } catch(e){
    console.error('Check deposit lock error:', e);
    return { locked: false };
  }
}

// Update deposit button state
async function updateDepositButtonState(){
  const depositBtn = document.getElementById('depositBtn');
  const pendingStatus = document.getElementById('pendingDepositStatus');
  
  try {
    // Check for pending deposit
    const pendingDeposit = await getPendingDeposit();
    const lockStatus = await checkDepositLock();
    
    if(pendingDeposit){
      // Show pending status
      depositBtn.textContent = 'â³ PENDING';
      depositBtn.disabled = false;
      depositBtn.style.opacity = '0.8';
      
      pendingStatus.classList.add('active');
      document.getElementById('pendingDepositAmount').textContent = 'Rs ' + pendingDeposit.amount;
      document.getElementById('pendingDepositMethod').textContent = 
        pendingDeposit.paymentMethod === 'jazzcash' ? 'JazzCash' : 'Easypaisa';
        
      // Update lock timer if locked
      if(lockStatus.locked){
        const minutes = Math.floor(lockStatus.remaining / 60);
        const seconds = lockStatus.remaining % 60;
        document.getElementById('depositLockTimer').textContent = 
          `ğŸ”’ Locked: ${minutes}:${seconds.toString().padStart(2,'0')} remaining`;
      } else {
        document.getElementById('depositLockTimer').textContent = '';
      }
    } else {
      // Normal state
      depositBtn.textContent = 'DEPOSIT';
      depositBtn.disabled = false;
      depositBtn.style.opacity = '1';
      pendingStatus.classList.remove('active');
      
      // Check if locked
      if(lockStatus.locked){
        depositBtn.disabled = true;
        depositBtn.style.opacity = '0.5';
        depositBtn.textContent = 'ğŸ”’ LOCKED';
        
        pendingStatus.classList.add('active');
        const minutes = Math.floor(lockStatus.remaining / 60);
        const seconds = lockStatus.remaining % 60;
        document.getElementById('depositLockTimer').textContent = 
          `ğŸ”’ Locked: ${minutes}:${seconds.toString().padStart(2,'0')} remaining`;
        document.getElementById('pendingDepositAmount').textContent = 'Deposit Locked';
        document.getElementById('pendingDepositMethod').textContent = 'Too many rejected requests';
      }
    }
  } catch(e){
    console.error('Update deposit button error:', e);
  }
}

// Get pending deposit for current user
async function getPendingDeposit(){
  try {
    const snapshot = await window.dbGet(window.dbRef(window.db, 'depositRequests'));
    if(!snapshot.exists()) return null;
    
    let pendingDeposit = null;
    snapshot.forEach(child => {
      const req = child.val();
      if(req.phone === gameState.userPhone && req.status === 'pending'){
        pendingDeposit = { id: child.key, ...req };
      }
    });
    
    return pendingDeposit;
  } catch(e){
    console.error('Get pending deposit error:', e);
    return null;
  }
}

// Listen to deposit requests
function listenToDepositRequests(){
  window.dbOnValue(window.dbRef(window.db, 'depositRequests'), snapshot => {
    updateDepositButtonState();
  });
}

// Open deposit modal
async function openDepositModal(){
  // Reset form
  switchDepositMethod('jazzcash');
  document.getElementById('depositAmount').value = '';
  
  // Check lock status
  const lockStatus = await checkDepositLock();
  if(lockStatus.locked){
    const minutes = Math.floor(lockStatus.remaining / 60);
    const seconds = lockStatus.remaining % 60;
    document.getElementById('depositCooldown').style.display = 'block';
    document.getElementById('depositCooldown').textContent = 
      `ğŸ”’ Locked for ${minutes}:${seconds.toString().padStart(2,'0')} (3 rejected requests)`;
  } else {
    document.getElementById('depositCooldown').style.display = 'none';
  }
  
  document.getElementById('depositModal').classList.add('active');
}

// Submit deposit request
async function submitDeposit(){
  playButtonMusic();
  
  const amount = parseInt(document.getElementById('depositAmount').value);
  const method = depositMethod; // Already 'jazzcash' or 'easypaisa'
  
  // Validation
  if(!amount || amount < 500){
    playSound('error');
    alert('Minimum deposit amount is Rs 500');
    return;
  }
  
  // Check lock status
  const lockStatus = await checkDepositLock();
  if(lockStatus.locked){
    playSound('error');
    const minutes = Math.floor(lockStatus.remaining / 60);
    const seconds = lockStatus.remaining % 60;
    alert(`Deposit locked! Wait ${minutes}:${seconds.toString().padStart(2,'0')}`);
    return;
  }
  
  // Check for existing pending deposit
  const pendingDeposit = await getPendingDeposit();
  if(pendingDeposit){
    playSound('error');
    alert('You already have a pending deposit request');
    return;
  }
  
  try {
    // Submit to Firebase
    const requestRef = window.dbPush(window.dbRef(window.db, 'depositRequests'));
    await window.dbSet(requestRef, {
      id: requestRef.key,
      userId: gameState.userPhone,
      name: gameState.userName,
      phone: gameState.userPhone,
      amount: amount,
      paymentMethod: method,
      status: 'pending',
      timestamp: Date.now(),
      createdAt: window.dbServerTimestamp()
    });
    
    playSound('success');
    alert('âœ… Deposit request submitted successfully!\nAdmin will approve soon.');
    closeModal('depositModal');
  } catch(e){
    console.error('Submit deposit error:', e);
    playSound('error');
    alert('âŒ Failed to submit deposit request');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WITHDRAW SYSTEM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let withdrawMethod = 'jazz';

// Withdraw method switching
function switchWithdrawMethod(method){
  playButtonMusic();
  withdrawMethod = method;
  const tabJ = document.getElementById('tabJazz');
  const tabE = document.getElementById('tabEasy');
  const input = document.getElementById('withdrawPhone');
  
  if(method === 'jazz'){
    tabJ.classList.add('active-tab');
    tabJ.classList.remove('easy-active');
    tabE.classList.remove('active-tab','easy-active');
    input.placeholder = 'JazzCash 03XXXXXXXXX';
  } else {
    tabE.classList.add('active-tab','easy-active');
    tabJ.classList.remove('active-tab');
    input.placeholder = 'Easypaisa 03XXXXXXXXX';
  }
}

// Get pending withdraw for current user
async function getPendingWithdraw(){
  try {
    const snapshot = await window.dbGet(window.dbRef(window.db, 'withdrawRequests'));
    if(!snapshot.exists()) return null;
    
    let pendingWithdraw = null;
    snapshot.forEach(child => {
      const req = child.val();
      if(req.phone === gameState.userPhone && req.status === 'pending'){
        pendingWithdraw = { id: child.key, ...req };
      }
    });
    
    return pendingWithdraw;
  } catch(e){
    console.error('Get pending withdraw error:', e);
    return null;
  }
}

// Update withdraw button state
async function updateWithdrawButtonState(){
  const withdrawBtn = document.getElementById('withdrawBtn');
  const pendingStatus = document.getElementById('pendingWithdrawStatus');
  
  try {
    const pendingWithdraw = await getPendingWithdraw();
    
    if(pendingWithdraw){
      // Show pending status
      withdrawBtn.textContent = 'â³ PENDING';
      withdrawBtn.disabled = false;
      withdrawBtn.style.opacity = '0.8';
      
      pendingStatus.classList.add('active');
      document.getElementById('pendingWithdrawAmount').textContent = 'Rs ' + pendingWithdraw.amount;
      document.getElementById('pendingWithdrawMethod').textContent = 
        pendingWithdraw.withdrawMethod === 'jazz' ? 'JazzCash' : 'Easypaisa';
      document.getElementById('pendingWithdrawNumber').textContent = 
        'To: ' + pendingWithdraw.jazzCash;
    } else {
      // Normal state
      withdrawBtn.textContent = 'WITHDRAW';
      withdrawBtn.disabled = false;
      withdrawBtn.style.opacity = '1';
      pendingStatus.classList.remove('active');
    }
  } catch(e){
    console.error('Update withdraw button error:', e);
  }
}

// Listen to withdraw requests
function listenToWithdrawRequests(){
  window.dbOnValue(window.dbRef(window.db, 'withdrawRequests'), snapshot => {
    updateWithdrawButtonState();
  });
}

// Check withdraw cooldown
function checkWithdrawCooldown(){
  const last = localStorage.getItem(`lastWithdraw_${gameState.userPhone}`);
  if(last){ 
    const elapsed = Date.now() - parseInt(last);
    const cooldown = 2 * 60 * 60 * 1000; // 2 hours
    if(elapsed < cooldown){
      return {
        allowed: false, 
        remaining: Math.ceil((cooldown - elapsed) / 60000)
      };
    }
  }
  return { allowed: true };
}

// Open withdraw modal
function openWithdrawModal(){
  // Reset form
  switchWithdrawMethod('jazz');
  document.getElementById('withdrawPhone').value = '';
  document.getElementById('withdrawAmount').value = '';
  
  // Check cooldown
  const cooldown = checkWithdrawCooldown();
  if(!cooldown.allowed){
    const hours = Math.floor(cooldown.remaining / 60);
    const minutes = cooldown.remaining % 60;
    document.getElementById('withdrawCooldown').style.display = 'block';
    document.getElementById('withdrawCooldown').textContent = 
      `â³ Wait ${hours}h ${minutes}m before next withdraw`;
  } else {
    document.getElementById('withdrawCooldown').style.display = 'none';
  }
  
  document.getElementById('withdrawModal').classList.add('active');
}

// Submit withdraw request
async function submitWithdraw(){
  playButtonMusic();
  
  const phone = document.getElementById('withdrawPhone').value.trim();
  const amount = parseInt(document.getElementById('withdrawAmount').value);
  
  // Validation
  if(!/^03[0-9]{9}$/.test(phone)){
    playSound('error');
    alert(withdrawMethod === 'jazz' ? 'Invalid JazzCash number!' : 'Invalid Easypaisa number!');
    return;
  }
  
  if(!amount || amount < 1000){
    playSound('error');
    alert('Minimum withdraw amount is Rs 1000');
    return;
  }
  
  if(amount > gameState.balance){
    playSound('error');
    alert('Insufficient balance!');
    return;
  }
  
  // Check cooldown
  const cooldown = checkWithdrawCooldown();
  if(!cooldown.allowed){
    playSound('error');
    const hours = Math.floor(cooldown.remaining / 60);
    const minutes = cooldown.remaining % 60;
    alert(`â³ Wait ${hours}h ${minutes}m before next withdraw`);
    return;
  }
  
  // Check for existing pending withdraw
  const pendingWithdraw = await getPendingWithdraw();
  if(pendingWithdraw){
    playSound('error');
    alert('You already have a pending withdraw request');
    return;
  }
  
  try {
    // Submit to Firebase
    const requestRef = window.dbPush(window.dbRef(window.db, 'withdrawRequests'));
    await window.dbSet(requestRef, {
      id: requestRef.key,
      userId: gameState.userPhone,
      name: gameState.userName,
      phone: gameState.userPhone,
      jazzCash: phone,
      withdrawMethod: withdrawMethod,
      amount: amount,
      status: 'pending',
      timestamp: Date.now(),
      createdAt: window.dbServerTimestamp()
    });
    
    // Update cooldown
    localStorage.setItem(`lastWithdraw_${gameState.userPhone}`, Date.now().toString());
    
    playSound('success');
    alert('âœ… Withdraw request submitted successfully!\nAdmin will process soon.');
    closeModal('withdrawModal');
  } catch(e){
    console.error('Submit withdraw error:', e);
    playSound('error');
    alert('âŒ Failed to submit withdraw request');
  }
}

/* â”€â”€â”€ Firebase helpers â”€â”€â”€ */
async function saveUserData(phone,data){
  await fbReady();
  try{
    await window.dbSet(window.dbRef(window.db,`users/${phone}`),{...data,lastUpdated:window.dbServerTimestamp()});
    return true;
  }catch(e){ console.error(e); return false; }
}

async function getUserData(phone){
  await fbReady();
  try{
    const snap = await window.dbGet(window.dbRef(window.db,`users/${phone}`));
    return snap.exists() ? snap.val() : null;
  }catch(e){ console.error(e); return null; }
}

async function updateUserBalance(phone,bal){
  await fbReady();
  try{
    await window.dbUpdate(window.dbRef(window.db,`users/${phone}`),{balance:bal,lastUpdated:window.dbServerTimestamp()});
    return true;
  }catch(e){ console.error(e); return false; }
}

function listenToUserData(phone){
  window.dbOnValue(window.dbRef(window.db,`users/${phone}`), snap=>{
    if(!snap.exists()) return;
    const d = snap.val();
    
    // Check if banned
    if(d.banned){
      showKickedScreen();
      return;
    }
    
    // Check if kicked (device changed or logged out)
    const currentDeviceId = getDeviceFingerprint();
    if(!d.isOnline || (d.deviceId && d.deviceId !== currentDeviceId)){
      showKickedScreen();
      return;
    }
    
    gameState.balance = d.balance||0;
    updateDisplay();
  });
}

/* â”€â”€â”€ Login â”€â”€â”€ */
async function handleLogin(){
  playButtonMusic();
  await fbReady();
  const name  = document.getElementById('loginName').value.trim();
  const phone = document.getElementById('loginPhone').value.trim();
  if(!name){ showMessage('loginMsg','Please enter your name!','error'); return; }
  if(!/^03[0-9]{9}$/.test(phone)){ showMessage('loginMsg','Invalid phone! Must be 03XXXXXXXXX','error'); return; }
  showMessage('loginMsg','Logging inâ€¦','success');

  const deviceId = getDeviceFingerprint();
  const namePairKey = `${name}_${phone}`;

  try {
    // Check: Banned phones
    const bannedPhoneSnap = await window.dbGet(window.dbRef(window.db, `bannedPhones/${phone}`));
    if(bannedPhoneSnap.exists()){
      showMessage('loginMsg','','error');
      setTimeout(() => showKickedScreen(), 500);
      return;
    }
    
    // Check: Phone number ban
    const phoneCheckSnap = await window.dbGet(window.dbRef(window.db, `users/${phone}`));
    if(phoneCheckSnap.exists()){
      const phoneUserData = phoneCheckSnap.val();
      if(phoneUserData.banned){
        showMessage('loginMsg','','error');
        setTimeout(() => showKickedScreen(), 500);
        return;
      }
    }
    
    // Check: Name-Phone pair lock
    const pairSnap = await window.dbGet(window.dbRef(window.db, `namePhonePairs/${namePairKey}`));
    if(pairSnap.exists()){
      const pairData = pairSnap.val();
      if(pairData.banned){
        showMessage('loginMsg','','error');
        setTimeout(() => showKickedScreen(), 500);
        return;
      }
      if(pairData.deviceId !== deviceId){
        showMessage('loginMsg','âŒ This name-phone combination is locked to another device!','error');
        return;
      }
    }
    
    // Check: Device limit (max 2 users per device)
    const deviceTrackSnap = await window.dbGet(window.dbRef(window.db, `deviceTracking/${deviceId}`));
    if(deviceTrackSnap.exists()){
      const deviceData = deviceTrackSnap.val();
      const usersOnDevice = deviceData.users || {};
      const userCount = Object.keys(usersOnDevice).length;
      
      if(!usersOnDevice[phone] && userCount >= 2){
        showMessage('loginMsg','âŒ Maximum 2 accounts per device!','error');
        return;
      }
      
      if(usersOnDevice[phone] && usersOnDevice[phone].name !== name){
        showMessage('loginMsg','âŒ Phone number registered with different name!','error');
        return;
      }
    }
    
    // Check: User already logged in or banned
    const userSnap = await window.dbGet(window.dbRef(window.db, `users/${phone}`));
    if(userSnap.exists()){
      const userData = userSnap.val();
      
      if(userData.banned){
        showKickedScreen();
        return;
      }
      
      if(userData.isOnline && userData.deviceId && userData.deviceId !== deviceId){
        showMessage('loginMsg','ÛŒÛ Ø§Ú©Ø§Ø¤Ù†Ù¹ Ù¾ÛÙ„Û’ Ø³Û’ Ú©Ø³ÛŒ Ø§ÙˆØ± ÚˆÛŒÙˆØ§Ø¦Ø³ Ù¾Ø± Ù„Ø§Ú¯ Ø§Ù† ÛÛ’!','error');
        return;
      }
      
      if(userData.name !== name){
        showMessage('loginMsg','âŒ Name does not match registered name!','error');
        return;
      }
    }
    
    // All checks passed - proceed with login
    const now = Date.now();
    const updates = {};
    
    let userData = userSnap.exists() ? userSnap.val() : null;
    
    // Update or create user data
    if(!userData){
      updates[`users/${phone}`] = {
        name, phone, balance:0, totalDeposit:0, totalWithdraw:0,
        createdAt:now, deviceId, isOnline:true, lastLogin:now
      };
    } else {
      updates[`users/${phone}/deviceId`] = deviceId;
      updates[`users/${phone}/isOnline`] = true;
      updates[`users/${phone}/lastLogin`] = now;
      updates[`users/${phone}/name`] = name;
    }
    
    // Lock name-phone pair to this device
    updates[`namePhonePairs/${namePairKey}/deviceId`] = deviceId;
    updates[`namePhonePairs/${namePairKey}/registeredAt`] = now;
    updates[`namePhonePairs/${namePairKey}/locked`] = true;
    
    // Track device usage
    updates[`deviceTracking/${deviceId}/users/${phone}/name`] = name;
    updates[`deviceTracking/${deviceId}/users/${phone}/lastLogin`] = now;
    
    await window.dbUpdate(window.dbRef(window.db), updates);
    
    // Continue with normal login flow
    gameState.userId = phone;
    gameState.userName = name;
    gameState.userPhone = phone;
    gameState.balance = userData ? (userData.balance || 0) : 0;
    
    document.getElementById('displayName').textContent = gameState.userName;
    document.getElementById('displayPhone').textContent = phone;
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    
    listenToUserData(phone);
    listenToDepositRequests();
    listenToWithdrawRequests();
    initializeGrid();
    updateDisplay();
    updateDepositButtonState();
    updateWithdrawButtonState();
    
    // Start deposit lock timer if needed
    startDepositLockTimer();
    
    if(!userData){
      showMessage('loginMsg','âœ… Account created!','success');
    }
    
  } catch(e){
    console.error(e);
    showMessage('loginMsg','âŒ Login failed: ' + e.message,'error');
  }
}

// Start deposit lock timer
function startDepositLockTimer(){
  if(depositLockTimer) clearInterval(depositLockTimer);
  
  depositLockTimer = setInterval(async () => {
    await updateDepositButtonState();
  }, 1000);
}

async function handleLogout(){
  if(confirm('Are you sure you want to logout?')){
    try{ 
      await fbReady(); 
      await window.dbUpdate(window.dbRef(window.db,`users/${gameState.userPhone}`),{isOnline:false,deviceId:null}); 
    }catch(e){}
    if(depositLockTimer) clearInterval(depositLockTimer);
    location.reload();
  }
}

function showKickedScreen(){ 
  document.getElementById('kickedOverlay').classList.add('active'); 
}

/* â”€â”€â”€ Grid & Tile logic â”€â”€â”€ */
function initializeGrid(){
  const grid = document.getElementById('gameGrid');
  grid.innerHTML='';
  for(let i=0;i<25;i++){
    const t = document.createElement('div');
    t.className='tile';
    t.onclick = ()=> clickTile(i);
    grid.appendChild(t);
  }
}

function clickTile(index){
  if(gameState.revealedTiles.includes(index)) return;
  if(!gameState.gameActive){
    if(gameState.currentBet===0){ 
      playSound('error');
      showMessage('gameMsg','Set bet first!','error'); 
      return; 
    }
    startGame();
  }
  gameState.tilesClicked = true;
  gameState.revealedTiles.push(index);
  const tiles = document.querySelectorAll('.tile');

  if(gameState.minePositions.includes(index)){
    playSound('mine');
    playBombBlast(); // Realistic bomb blast sound
    tiles[index].textContent = 'ğŸ’£';
    tiles[index].classList.add('revealed','mine','mine-hit');
    gameOver(false);
  } else {
    playSound('success');
    // Play ascending musical note based on tile position
    const notes = [523, 587, 659, 698, 784, 880, 988, 1047]; // C5 to C6 scale
    playMusicNote(notes[gameState.revealedTiles.length % notes.length]);
    tiles[index].textContent = 'ğŸ’';
    tiles[index].classList.add('revealed','safe');
    gameState.currentWin += Math.floor(gameState.currentBet * getWinRate());
    updateDisplay();
    document.getElementById('cashoutBtn').disabled = false;
  }
}

function startGame(){
  playSound('click');
  gameState.gameActive    = true;
  gameState.minePositions = [];
  gameState.revealedTiles = [];
  gameState.currentWin    = 0;
  while(gameState.minePositions.length < gameState.minesCount){
    const p = Math.floor(Math.random()*25);
    if(!gameState.minePositions.includes(p)) gameState.minePositions.push(p);
  }
  updateDisplay();
}

async function cashout(){
  if(!gameState.gameActive || gameState.currentWin===0) return;
  playSound('win');
  playButtonMusic();
  const total = gameState.currentBet + gameState.currentWin;
  gameState.balance += total;
  await updateUserBalance(gameState.userPhone, gameState.balance);
  gameState.currentBet=0; gameState.currentWin=0; gameState.gameActive=false;
  gameState.betSet=false; gameState.tilesClicked=false;
  document.getElementById('cashoutBtn').disabled=true;
  updateDisplay(); revealAllTiles();
  showMessage('gameMsg',`Cashed out Rs ${total}! ğŸ‰`,'success');
}

function gameOver(won){
  if(!won) playSound('error');
  gameState.gameActive=false; gameState.currentBet=0; gameState.currentWin=0;
  gameState.betSet=false; gameState.tilesClicked=false;
  document.getElementById('cashoutBtn').disabled=true;
  updateDisplay(); revealAllTiles();
  if(!won) showMessage('gameMsg','Game Over! ğŸ’”','error');
}

function revealAllTiles(){
  document.querySelectorAll('.tile').forEach((t,i)=>{
    if(!t.classList.contains('revealed')){
      t.classList.add('revealed');
      if(gameState.minePositions.includes(i)){
        t.textContent='ğŸ’£'; t.classList.add('mine');
      } else {
        t.textContent='ğŸ’'; t.classList.add('safe');
      }
    }
  });
}

async function resetGame(){
  playButtonMusic();
  if(gameState.betSet && gameState.currentBet>0){
    const ret = gameState.currentBet + gameState.currentWin;
    gameState.balance += ret;
    await updateUserBalance(gameState.userPhone, gameState.balance);
    showMessage('gameMsg',
      gameState.tilesClicked
        ? `Rs ${gameState.currentBet} (bet) + Rs ${gameState.currentWin} (win) ÙˆØ§Ù¾Ø³ ÛÙˆ Ú¯Ø¦Û’!`
        : `Rs ${gameState.currentBet} ÙˆØ§Ù¾Ø³ ÛÙˆ Ú¯ÛŒØ§!`,
      'success');
  }
  gameState.gameActive=false; gameState.currentWin=0; gameState.currentBet=0;
  gameState.minePositions=[]; gameState.revealedTiles=[];
  gameState.betSet=false; gameState.tilesClicked=false;
  document.getElementById('cashoutBtn').disabled=true;
  initializeGrid(); updateDisplay();
}

function updateDisplay(){
  document.getElementById('balance').textContent      = gameState.balance;
  document.getElementById('win').textContent          = gameState.currentWin;
  document.getElementById('betDisplay').textContent   = gameState.currentBet;
  document.getElementById('minesDisplay').textContent = gameState.minesCount;
}

/* â”€â”€â”€ Bet / Mines modals â”€â”€â”€ */
function openBetModal(){
  playButtonMusic();
  if(gameState.gameActive){ 
    playSound('error');
    alert('Cannot change bet during active game!'); 
    return; 
  }
  document.getElementById('betModal').classList.add('active');
}

async function setBet(){
  const a = parseInt(document.getElementById('betInput').value);
  if(!a||a<100||a>10000){ 
    playSound('error');
    alert('Bet must be Rs 100â€“10,000'); 
    return; 
  }
  
  // Check if bet is already set with the same amount
  if(gameState.betSet && gameState.currentBet === a){
    playSound('error');
    alert('Bet already set with this amount!');
    return;
  }
  
  // If changing bet amount, refund the old bet first
  if(gameState.betSet && gameState.currentBet > 0 && gameState.currentBet !== a){
    gameState.balance += gameState.currentBet;
  }
  
  // Check if user has enough balance for new bet
  if(a > gameState.balance){ 
    playSound('error');
    alert('Insufficient balance!'); 
    return; 
  }
  
  // Deduct balance and set bet
  playButtonMusic();
  gameState.balance -= a; 
  gameState.currentBet = a; 
  gameState.betSet = true; 
  gameState.tilesClicked = false;
  await updateUserBalance(gameState.userPhone, gameState.balance);
  updateDisplay(); 
  closeModal('betModal');
  showMessage('gameMsg','Bet set! Start playing!','success');
}

function openMinesModal(){
  playButtonMusic();
  if(gameState.gameActive){ 
    playSound('error');
    alert('Cannot change mines during game!'); 
    return; 
  }
  document.getElementById('minesModal').classList.add('active');
}

function setMines(){
  const c = parseInt(document.getElementById('minesInput').value);
  if(!c||c<1||c>24){ 
    playSound('error');
    alert('Mines must be 1â€“24'); 
    return; 
  }
  playButtonMusic();
  gameState.minesCount=c; updateDisplay(); closeModal('minesModal');
}

/* â”€â”€â”€ UI helpers â”€â”€â”€ */
function closeModal(id){ 
  document.getElementById(id).classList.remove('active'); 
}

function showMessage(elId, text, type){
  const el = document.getElementById(elId);
  el.textContent=text; el.className='msg '+type; el.style.display='block';
  setTimeout(()=>el.style.display='none', 3000);
}

</script>

</body>
</html>