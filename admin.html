<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin â€“ Mines Game</title>

<!-- Firebase Compat SDK â€” loaded in <head> so they are 100% ready before any script in <body> -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold:          #f0c040;
  --neon-cyan:     #22d3ee;
  --neon-emerald:  #34d399;
  --neon-amber:    #fbbf24;
  --neon-rose:     #fb7185;
  --neon-blue:     #60a5fa;
  --neon-purple:   #a78bfa;
  --bg-deep:       #0a0c14;
  --glass-bg:      rgba(18, 22, 40, 0.72);
  --glass-border:  rgba(255,255,255,0.11);
  --glass-border2: rgba(255,255,255,0.20);
  --text-primary:  #f0f0f5;
  --text-muted:    #9aa0b8;
  --radius:        16px;
  --radius-sm:     10px;
  --blur-main:     22px;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

html, body {
  min-height:100vh;
  font-family:'Rajdhani', sans-serif;
  background: var(--bg-deep);
  color: var(--text-primary);
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ Canvas BG â”€â”€â”€ */
#bgCanvas {
  position:fixed; top:0; left:0;
  width:100%; height:100%;
  z-index:0; pointer-events:none;
}
body::before {
  content:'';
  position:fixed; inset:0; z-index:1;
  pointer-events:none; opacity:.035;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
  background-size:200px 200px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar       { width:6px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:rgba(255,255,255,.14); border-radius:3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.login-screen {
  position:relative; z-index:2;
  display:flex; justify-content:center; align-items:center;
  min-height:100vh; padding:20px;
}
.login-box {
  background: rgba(18,22,40,0.78);
  backdrop-filter: blur(var(--blur-main)) saturate(1.4);
  -webkit-backdrop-filter: blur(var(--blur-main)) saturate(1.4);
  border: 1.5px solid var(--glass-border2);
  border-radius: var(--radius);
  box-shadow: 0 8px 44px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.07);
  padding:44px 36px 40px;
  max-width:380px; width:100%;
  text-align:center;
}
.login-title {
  font-family:'Orbitron', sans-serif;
  font-size:28px; font-weight:900;
  letter-spacing:6px;
  background: linear-gradient(135deg, #f0c040, #fbbf24, #f59e0b);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  filter: drop-shadow(0 0 16px rgba(240,192,64,.4));
  margin-bottom:6px;
}
.login-sub {
  font-size:13px; color:var(--text-muted);
  letter-spacing:2px; margin-bottom:28px;
}
.login-input {
  width:100%; padding:14px 18px; margin:10px 0;
  background: rgba(12,15,26,0.78);
  border: 1.5px solid var(--glass-border2);
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:17px; font-weight:500;
  color: var(--text-primary); outline:none;
  transition: border-color .25s, box-shadow .25s;
}
.login-input::placeholder { color:var(--text-muted); }
.login-input:focus {
  border-color: var(--neon-cyan);
  box-shadow: 0 0 14px rgba(34,211,238,.25);
}
.login-btn {
  width:100%; padding:15px; margin-top:14px;
  background: rgba(52,211,153,.18);
  border: 1.5px solid rgba(52,211,153,.55);
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:18px; font-weight:700;
  letter-spacing:2px; color: var(--neon-emerald);
  cursor:pointer; text-transform:uppercase;
  box-shadow: 0 0 14px rgba(52,211,153,.18);
  transition: transform .18s, box-shadow .25s, background .22s;
}
.login-btn:hover { transform:translateY(-2px); box-shadow:0 0 26px rgba(52,211,153,.4); background:rgba(52,211,153,.28); }
.login-btn:active { transform:translateY(0); }

/* â”€â”€ Firebase status pill (visible on login screen) â”€â”€ */
.fb-status {
  margin-top:18px; font-size:13px; font-weight:600;
  letter-spacing:1px; color:var(--text-muted);
}
.fb-status .dot { display:inline-block; width:9px; height:9px; border-radius:50%; margin-right:6px; }
.fb-status.connected .dot { background:var(--neon-emerald); box-shadow:0 0 6px rgba(52,211,153,.5); }
.fb-status.connected { color:var(--neon-emerald); }
.fb-status.failed .dot { background:var(--neon-rose); box-shadow:0 0 6px rgba(251,113,133,.5); }
.fb-status.failed { color:var(--neon-rose); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD WRAPPER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dashboard {
  position:relative; z-index:2;
  display:none;
  max-width:1120px; margin:0 auto;
  padding:22px 18px 48px;
}
.dashboard.active { display:block; }

/* â”€â”€â”€ Header â”€â”€â”€ */
.dash-header {
  display:flex; justify-content:space-between; align-items:center;
  flex-wrap:wrap; gap:12px;
  margin-bottom:22px;
}
.dash-title {
  font-family:'Orbitron', sans-serif;
  font-size:24px; font-weight:900;
  letter-spacing:5px;
  background: linear-gradient(135deg, #f0c040, #fbbf24);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  background-clip:text;
  filter: drop-shadow(0 0 12px rgba(240,192,64,.35));
}
.dash-logout {
  padding:10px 22px; border-radius: var(--radius-sm);
  background: rgba(251,113,133,.15);
  border: 1.5px solid rgba(251,113,133,.5);
  color: var(--neon-rose);
  font-family:'Rajdhani', sans-serif;
  font-size:15px; font-weight:700;
  letter-spacing:1px; cursor:pointer;
  text-transform:uppercase;
  transition: background .2s, box-shadow .2s;
}
.dash-logout:hover { background:rgba(251,113,133,.26); box-shadow:0 0 18px rgba(251,113,133,.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STAT CARDS ROW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-row {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap:14px; margin-bottom:22px;
}
.stat-card {
  background: rgba(18,22,40,0.72);
  backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px);
  border: 1.5px solid var(--glass-border2);
  border-radius: var(--radius);
  box-shadow: 0 6px 28px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.06);
  padding:20px 16px; text-align:center;
  position:relative; overflow:hidden;
}
.stat-card::before {
  content:'';
  position:absolute; top:0; left:10%; right:10%; height:2px;
  background: var(--card-glow, var(--neon-cyan));
  filter: blur(3px);
  opacity:.7;
}
.stat-card[data-color="cyan"]   { --card-glow: var(--neon-cyan); }
.stat-card[data-color="emerald"]{ --card-glow: var(--neon-emerald); }
.stat-card[data-color="amber"]  { --card-glow: var(--neon-amber); }
.stat-card[data-color="purple"] { --card-glow: var(--neon-purple); }

.stat-label {
  font-size:11px; color:var(--text-muted);
  letter-spacing:2.2px; text-transform:uppercase; margin-bottom:8px;
}
.stat-value {
  font-family:'Orbitron', sans-serif;
  font-size:28px; font-weight:700;
  color: var(--gold);
  text-shadow: 0 0 10px rgba(240,192,64,.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tabs {
  display:flex; gap:8px; margin-bottom:18px;
  flex-wrap:wrap;
}
.tab {
  padding:11px 22px; border-radius: var(--radius-sm);
  background: rgba(18,22,40,0.65);
  border: 1.5px solid var(--glass-border);
  color: var(--text-muted);
  font-family:'Rajdhani', sans-serif;
  font-size:15px; font-weight:600;
  letter-spacing:1px; cursor:pointer;
  text-transform:uppercase;
  transition: background .22s, border-color .22s, color .22s, box-shadow .25s;
}
.tab:hover { border-color: rgba(255,255,255,.25); color:var(--text-primary); }
.tab.active {
  background: rgba(240,192,64,.15);
  border-color: rgba(240,192,64,.55);
  color: var(--gold);
  box-shadow: 0 0 16px rgba(240,192,64,.22);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAB CONTENT PANELS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tab-content { display:none; }
.tab-content.active { display:block; }

.tab-heading {
  font-family:'Orbitron', sans-serif;
  font-size:14px; font-weight:600;
  letter-spacing:3px; color:var(--text-muted);
  text-transform:uppercase;
  margin-bottom:14px; padding-bottom:10px;
  border-bottom:1px solid var(--glass-border);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: rgba(14,18,32,0.72);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius-sm);
  box-shadow: 0 4px 20px rgba(0,0,0,.38), inset 0 1px 0 rgba(255,255,255,.05);
  padding:18px 18px 16px;
  margin-bottom:12px;
  transition: border-color .22s;
}
.card:hover { border-color: var(--glass-border2); }

.card-header {
  display:flex; justify-content:space-between;
  align-items:flex-start; flex-wrap:wrap; gap:10px;
  margin-bottom:10px;
}
.card-title {
  font-family:'Orbitron', sans-serif;
  font-size:14px; font-weight:700;
  color:var(--text-primary); letter-spacing:1px;
}
.card-info {
  font-size:14px; color:var(--text-muted);
  margin:4px 0; line-height:1.5;
}
.card-amount {
  font-family:'Orbitron', sans-serif;
  font-size:22px; font-weight:700;
  color:var(--gold);
  text-shadow: 0 0 8px rgba(240,192,64,.35);
  margin:8px 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLAYER CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.player-card {
  background: rgba(14,18,32,0.75);
  backdrop-filter: blur(12px);
  border: 1.5px solid var(--glass-border);
  border-radius: var(--radius-sm);
  box-shadow: 0 4px 20px rgba(0,0,0,.38), inset 0 1px 0 rgba(255,255,255,.05);
  padding:16px 18px;
  margin-bottom:10px;
  display:flex; justify-content:space-between; align-items:center;
  gap:12px;
  transition: border-color .22s;
}
.player-card:hover { border-color: rgba(240,192,64,.3); }

.player-left { display:flex; align-items:center; gap:14px; }
.player-avatar {
  width:42px; height:42px; border-radius:50%;
  background: rgba(240,192,64,.15);
  border: 1.5px solid rgba(240,192,64,.4);
  display:flex; align-items:center; justify-content:center;
  font-family:'Orbitron', sans-serif;
  font-size:16px; font-weight:700;
  color:var(--gold);
  flex-shrink:0;
}
.player-name {
  font-family:'Orbitron', sans-serif;
  font-size:14px; font-weight:700;
  color:var(--text-primary); letter-spacing:.8px;
  margin-bottom:3px;
}
.player-phone { font-size:13px; color:var(--text-muted); }

.player-balance {
  font-family:'Orbitron', sans-serif;
  font-size:20px; font-weight:700;
  color:var(--gold);
  text-shadow: 0 0 8px rgba(240,192,64,.35);
  white-space:nowrap;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS BADGES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.badge {
  display:inline-block;
  font-size:11px; font-weight:700;
  letter-spacing:1px; text-transform:uppercase;
  padding:4px 10px; border-radius:20px;
}
.badge-online {
  color: var(--neon-emerald);
  background: rgba(52,211,153,.14);
  border: 1px solid rgba(52,211,153,.4);
  box-shadow: 0 0 6px rgba(52,211,153,.18);
}
.badge-offline {
  color: var(--text-muted);
  background: rgba(150,150,150,.1);
  border: 1px solid rgba(150,150,150,.2);
}
.badge-pending {
  color: var(--neon-amber);
  background: rgba(251,191,36,.12);
  border: 1px solid rgba(251,191,36,.4);
  box-shadow: 0 0 6px rgba(251,191,36,.15);
}
.badge-approved {
  color: var(--neon-emerald);
  background: rgba(52,211,153,.14);
  border: 1px solid rgba(52,211,153,.4);
}
.badge-rejected {
  color: var(--neon-rose);
  background: rgba(251,113,133,.14);
  border: 1px solid rgba(251,113,133,.4);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn-row { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
.btn-action {
  padding:9px 18px; border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:14px; font-weight:700;
  letter-spacing:1px; cursor:pointer;
  border:1.5px solid; text-transform:uppercase;
  transition: transform .18s, box-shadow .25s, background .22s;
}
.btn-action:hover { transform:translateY(-1px); }
.btn-action:active { transform:translateY(0); }

.btn-approve {
  color:var(--neon-emerald);
  background:rgba(52,211,153,.16);
  border-color:rgba(52,211,153,.5);
  box-shadow:0 0 10px rgba(52,211,153,.15);
}
.btn-approve:hover { box-shadow:0 0 20px rgba(52,211,153,.35); background:rgba(52,211,153,.24); }

.btn-reject {
  color:var(--neon-rose);
  background:rgba(251,113,133,.15);
  border-color:rgba(251,113,133,.5);
  box-shadow:0 0 10px rgba(251,113,133,.15);
}
.btn-reject:hover { box-shadow:0 0 20px rgba(251,113,133,.35); background:rgba(251,113,133,.24); }

.btn-delete {
  color:var(--neon-amber);
  background:rgba(251,191,36,.13);
  border-color:rgba(251,191,36,.45);
  box-shadow:0 0 10px rgba(251,191,36,.13);
}
.btn-delete:hover { box-shadow:0 0 20px rgba(251,191,36,.3); background:rgba(251,191,36,.22); }

.btn-edit {
  color:var(--neon-blue);
  background:rgba(96,165,250,.15);
  border-color:rgba(96,165,250,.48);
  box-shadow:0 0 10px rgba(96,165,250,.13);
}
.btn-edit:hover { box-shadow:0 0 20px rgba(96,165,250,.32); background:rgba(96,165,250,.24); }

.btn-kick {
  color:var(--neon-purple);
  background:rgba(167,139,250,.14);
  border-color:rgba(167,139,250,.48);
  box-shadow:0 0 10px rgba(167,139,250,.13);
}
.btn-kick:hover { box-shadow:0 0 20px rgba(167,139,250,.32); background:rgba(167,139,250,.24); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AMOUNT COLORS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.amount-green { color:var(--neon-emerald); }
.amount-rose  { color:var(--neon-rose); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NO DATA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.no-data {
  text-align:center; padding:48px 20px;
  color:var(--text-muted); font-size:16px;
  letter-spacing:1px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  display:none; position:fixed; inset:0;
  background: rgba(4,5,10,0.78);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index:1000;
  justify-content:center; align-items:center;
  padding:20px;
}
.modal-overlay.active { display:flex; }

.modal-box {
  background: rgba(14,18,32,0.88);
  backdrop-filter: blur(28px) saturate(1.3);
  -webkit-backdrop-filter: blur(28px) saturate(1.3);
  border: 1.5px solid var(--glass-border2);
  box-shadow: 0 14px 52px rgba(0,0,0,.58), inset 0 1px 0 rgba(255,255,255,.07);
  padding:32px 28px;
  border-radius: var(--radius);
  max-width:420px; width:100%;
}
.modal-title {
  font-family:'Orbitron', sans-serif;
  font-size:18px; font-weight:700;
  color:var(--gold); text-align:center;
  letter-spacing:2px; margin-bottom:22px;
  text-shadow: 0 0 12px rgba(240,192,64,.35);
}
.modal-row {
  display:flex; justify-content:space-between;
  padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06);
}
.modal-row:last-of-type { border-bottom:none; }
.modal-row-label { color:var(--text-muted); font-size:14px; }
.modal-row-value { color:var(--text-primary); font-weight:600; font-size:14px; }

.modal-input {
  width:100%; padding:14px 16px; margin:18px 0 10px;
  background: rgba(12,15,26,0.78);
  border: 1.5px solid var(--glass-border2);
  border-radius: var(--radius-sm);
  font-family:'Rajdhani', sans-serif;
  font-size:18px; font-weight:600;
  color:var(--text-primary); outline:none;
  transition: border-color .25s, box-shadow .25s;
}
.modal-input:focus {
  border-color:var(--neon-cyan);
  box-shadow:0 0 14px rgba(34,211,238,.25);
}
.modal-btns { display:flex; gap:10px; margin-top:8px; }
.modal-btns .btn-action { flex:1; text-align:center; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media(max-width:540px){
  .dashboard      { padding:16px 12px 40px; }
  .dash-title     { font-size:18px; letter-spacing:3px; }
  .stat-value     { font-size:22px; }
  .tab            { padding:9px 16px; font-size:13px; }
  .player-card    { flex-direction:column; align-items:flex-start; }
  .player-balance { font-size:18px; }
  .card-amount    { font-size:19px; }
  .modal-box      { padding:24px 18px; }
}
</style>
</head>
<body>

<!-- â•â•â• PARTICLE CANVAS â•â•â• -->
<canvas id="bgCanvas"></canvas>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen" class="login-screen">
  <div class="login-box">
    <div class="login-title">ADMIN</div>
    <div class="login-sub">ğŸ” SECURE ACCESS</div>
    <input type="password" id="adminPassword" class="login-input"
           placeholder="Enter Password"
           onkeydown="if(event.key==='Enter') adminLogin()">
    <button class="login-btn" onclick="adminLogin()">Login</button>
    <div id="fbStatus" class="fb-status">
      <span class="dot"></span><span id="fbStatusText">Connectingâ€¦</span>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="dashboard" class="dashboard">

  <!-- Header -->
  <div class="dash-header">
    <div class="dash-title">ğŸ® ADMIN DASHBOARD</div>
    <button class="dash-logout" onclick="adminLogout()">Logout</button>
  </div>

  <!-- Stat Cards -->
  <div class="stats-row">
    <div class="stat-card" data-color="cyan">
      <div class="stat-label">Total Users</div>
      <div class="stat-value" id="totalUsers">0</div>
    </div>
    <div class="stat-card" data-color="emerald">
      <div class="stat-label">Online Now</div>
      <div class="stat-value" id="onlineUsers">0</div>
    </div>
    <div class="stat-card" data-color="amber">
      <div class="stat-label">Total Deposits</div>
      <div class="stat-value">Rs <span id="totalDeposits">0</span></div>
    </div>
    <div class="stat-card" data-color="purple">
      <div class="stat-label">Total Withdrawals</div>
      <div class="stat-value">Rs <span id="totalWithdrawals">0</span></div>
    </div>
  </div>

  <!-- Reset Stats Button -->
  <div style="margin-bottom:22px; text-align:right;">
    <button class="btn-action btn-delete" onclick="resetStats()" style="width:auto; padding:10px 24px;">
      ğŸ”„ Reset All Stats
    </button>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" onclick="showTab('players',this)">ğŸ‘¥ Players</button>
    <button class="tab"        onclick="showTab('users',this)">ğŸ“‹ Users</button>
    <button class="tab"        onclick="showTab('deposits',this)">ğŸ’° Deposits</button>
    <button class="tab"        onclick="showTab('withdraws',this)">ğŸ’¸ Withdrawals</button>
  </div>

  <!-- â”€â”€ PLAYERS TAB â”€â”€ -->
  <div id="players" class="tab-content active">
    <div class="tab-heading">Live Player Balances</div>
    <div id="playersContent"><div class="no-data">Loadingâ€¦</div></div>
  </div>

  <!-- â”€â”€ USERS TAB â”€â”€ -->
  <div id="users" class="tab-content">
    <div class="tab-heading">All Users â€“ Manage & Kick</div>
    <div id="usersContent"><div class="no-data">Loadingâ€¦</div></div>
  </div>

  <!-- â”€â”€ DEPOSITS TAB â”€â”€ -->
  <div id="deposits" class="tab-content">
    <div class="tab-heading">Deposit Requests</div>
    <div id="depositsContent"><div class="no-data">Loadingâ€¦</div></div>
  </div>

  <!-- â”€â”€ WITHDRAWALS TAB â”€â”€ -->
  <div id="withdraws" class="tab-content">
    <div class="tab-heading">Withdrawal Requests</div>
    <div id="withdrawsContent"><div class="no-data">Loadingâ€¦</div></div>
  </div>
</div>

<!-- â•â•â• EDIT BALANCE MODAL â•â•â• -->
<div id="editBalanceModal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-title">âœï¸ Edit Balance</div>
    <div class="modal-row">
      <span class="modal-row-label">User</span>
      <span class="modal-row-value" id="editUserName">â”€</span>
    </div>
    <div class="modal-row">
      <span class="modal-row-label">Phone</span>
      <span class="modal-row-value" id="editUserPhone">â”€</span>
    </div>
    <div class="modal-row">
      <span class="modal-row-label">Current Balance</span>
      <span class="modal-row-value" id="editCurrentBalance">Rs 0</span>
    </div>
    <input type="number" id="editNewBalance" class="modal-input" placeholder="New balance">
    <div class="modal-btns">
      <button class="btn-action btn-approve" onclick="saveBalance()">Save</button>
      <button class="btn-action btn-reject"  onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PARTICLE ENGINE
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
  const canvas = document.getElementById('bgCanvas');
  const ctx    = canvas.getContext('2d');
  let W, H;
  function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; }
  window.addEventListener('resize',resize); resize();

  const PART_COUNT=90, SHARD_COUNT=16;
  const PALETTE=[[34,211,238],[96,165,250],[52,211,153],[240,192,64],[251,191,36],[180,195,240]];

  class Particle {
    constructor(){ this.reset(true); }
    reset(i){
      this.x=i?Math.random()*W:(Math.random()<.5?-12:W+12);
      this.y=i?Math.random()*H:Math.random()*H;
      this.r=.5+Math.random()*2.4;
      this.vx=(Math.random()-.5)*.38; this.vy=(Math.random()-.5)*.38;
      this.col=PALETTE[Math.floor(Math.random()*PALETTE.length)];
      this.alpha=.12+Math.random()*.5;
      this.phase=Math.random()*Math.PI*2; this.freq=.35+Math.random()*.55;
    }
    update(){ this.x+=this.vx; this.y+=this.vy; this.phase+=this.freq*.016; if(this.x<-30||this.x>W+30||this.y<-30||this.y>H+30) this.reset(false); }
    draw(){
      const a=this.alpha+Math.sin(this.phase)*.13, [r,g,b]=this.col;
      ctx.beginPath(); ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
      ctx.fillStyle=`rgba(${r},${g},${b},${a})`; ctx.fill();
      ctx.beginPath(); ctx.arc(this.x,this.y,this.r*3.5,0,Math.PI*2);
      ctx.fillStyle=`rgba(${r},${g},${b},${a*.16})`; ctx.fill();
    }
  }
  class Shard {
    constructor(){ this.reset(true); }
    reset(i){
      this.x=i?Math.random()*W:-70; this.y=i?Math.random()*H:Math.random()*H;
      this.w=2.5+Math.random()*4; this.h=28+Math.random()*75;
      this.angle=-.52+Math.random()*.25; this.speed=.28+Math.random()*.32;
      this.alpha=.028+Math.random()*.065;
      this.col=[195+Math.random()*60,210+Math.random()*45,255];
    }
    update(){ this.x+=this.speed; if(this.x>W+100)this.reset(false); }
    draw(){
      ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.angle);
      const g=ctx.createLinearGradient(0,0,0,this.h), [r,gr,b]=this.col;
      g.addColorStop(0,`rgba(${r},${gr},${b},0)`);
      g.addColorStop(.28,`rgba(${r},${gr},${b},${this.alpha})`);
      g.addColorStop(.72,`rgba(${r},${gr},${b},${this.alpha})`);
      g.addColorStop(1,`rgba(${r},${gr},${b},0)`);
      ctx.fillStyle=g; ctx.fillRect(-this.w*.5,0,this.w,this.h); ctx.restore();
    }
  }

  const particles=[], shards=[];
  for(let i=0;i<PART_COUNT;i++) particles.push(new Particle());
  for(let i=0;i<SHARD_COUNT;i++) shards.push(new Shard());

  function drawBg(){
    const g=ctx.createLinearGradient(0,0,W*.55,H);
    g.addColorStop(0,'#0a0c14'); g.addColorStop(.4,'#0e1320');
    g.addColorStop(.72,'#111a2e'); g.addColorStop(1,'#0c1118');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    [
      {x:W*.12,y:H*.28,r:W*.24,c:'rgba(34,211,238,.032)'},
      {x:W*.82,y:H*.68,r:W*.21,c:'rgba(96,165,250,.028)'},
      {x:W*.48,y:H*.88,r:W*.19,c:'rgba(52,211,153,.022)'},
      {x:W*.72,y:H*.12,r:W*.17,c:'rgba(240,192,64,.020)'},
      {x:W*.25,y:H*.75,r:W*.15,c:'rgba(251,191,36,.018)'},
    ].forEach(b=>{
      const rg=ctx.createRadialGradient(b.x,b.y,0,b.x,b.y,b.r);
      rg.addColorStop(0,b.c); rg.addColorStop(1,'transparent');
      ctx.fillStyle=rg; ctx.fillRect(0,0,W,H);
    });
  }
  function loop(){ drawBg(); shards.forEach(s=>{s.update();s.draw();}); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(loop); }
  loop();
})();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FIREBASE INIT  â€”  runs AFTER compat SDK is guaranteed loaded
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ guard: only init once â”€â”€
let db = null;

function initFirebase(){
  try {
    if(!firebase.apps.length){
      firebase.initializeApp({
        apiKey:"AIzaSyA8C1-TpsRo0UsATshlI8Dy0v40PnLRlc4",
        authDomain:"mines-67d8c.firebaseapp.com",
        databaseURL:"https://mines-67d8c-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId:"mines-67d8c",
        storageBucket:"mines-67d8c.firebasestorage.app",
        messagingSenderId:"918317634273",
        appId:"1:918317634273:web:8527c0d58a1f3de0371da0",
        measurementId:"G-NHC6K1X3KZ"
      });
    }
    db = firebase.database();

    // â”€â”€ connectivity test: read users (lightweight, no write needed) â”€â”€
    db.ref('users').once('value').then(()=>{
      setFbStatus(true);
      console.log('âœ… Firebase connected');
    }).catch(err=>{
      setFbStatus(false);
      console.error('âŒ Firebase connection failed:', err);
    });

  } catch(err){
    setFbStatus(false);
    console.error('âŒ Firebase init error:', err);
  }
}

function setFbStatus(ok){
  const el   = document.getElementById('fbStatus');
  const txt  = document.getElementById('fbStatusText');
  el.className = 'fb-status ' + (ok ? 'connected' : 'failed');
  txt.textContent = ok ? 'Firebase Connected âœ“' : 'Firebase Failed âœ—';
}

// run immediately â€” compat SDK scripts are in <head> so they are loaded by now
initFirebase();
</script>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADMIN LOGIC
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ Globals â”€â”€
const ADMIN_PASSWORD = '@/Aa362014300';
let currentEditUser  = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LOGIN / LOGOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function adminLogin(){
  const pw = document.getElementById('adminPassword').value;
  if(pw === ADMIN_PASSWORD){
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('dashboard').classList.add('active');
    setupRealTimeListeners();
  } else {
    alert('âŒ Wrong password!');
  }
}
function adminLogout(){ if(confirm('Logout?')) location.reload(); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REAL-TIME LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setupRealTimeListeners(){
  if(!db){ alert('Firebase not connected!'); return; }

  db.ref('users').on('value', function(snapshot){
    renderPlayers(snapshot);
    renderUsers(snapshot);
    updateStatsFromSnapshots(snapshot);
  });

  db.ref('depositRequests').on('value', function(snapshot){
    renderDeposits(snapshot);
  });

  db.ref('withdrawRequests').on('value', function(snapshot){
    renderWithdraws(snapshot);
  });

  // also fetch deposit+withdraw snapshots for stats immediately
  fetchAndUpdateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchAndUpdateStats(){
  if(!db) return;
  try {
    const [usersSnap, depSnap, wdSnap] = await Promise.all([
      db.ref('users').once('value'),
      db.ref('depositRequests').once('value'),
      db.ref('withdrawRequests').once('value')
    ]);
    calcStats(usersSnap, depSnap, wdSnap);
  } catch(e){ console.error('fetchAndUpdateStats:', e); }
}

function updateStatsFromSnapshots(usersSnap){
  // called from users listener â€” re-fetch dep+wd for full stats
  if(!db) return;
  Promise.all([
    db.ref('depositRequests').once('value'),
    db.ref('withdrawRequests').once('value')
  ]).then(([depSnap, wdSnap])=>{
    calcStats(usersSnap, depSnap, wdSnap);
  }).catch(e=> console.error('updateStats:', e));
}

function calcStats(usersSnap, depSnap, wdSnap){
  let totalUsers=0, onlineUsers=0, totalDepositAmount=0, totalWithdrawAmount=0;
  if(usersSnap && usersSnap.exists()){
    const obj = usersSnap.val();
    totalUsers = Object.keys(obj).length;
    Object.values(obj).forEach(u=>{ 
      if(u.isOnline) onlineUsers++; 
      totalDepositAmount += (u.totalDeposit || 0);
      totalWithdrawAmount += (u.totalWithdraw || 0);
    });
  }
  document.getElementById('totalUsers').textContent       = totalUsers;
  document.getElementById('onlineUsers').textContent      = onlineUsers;
  document.getElementById('totalDeposits').textContent    = totalDepositAmount.toLocaleString();
  document.getElementById('totalWithdrawals').textContent = totalWithdrawAmount.toLocaleString();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYERS TAB  â€”  receives snapshot directly from listener
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPlayers(snapshot){
  const content = document.getElementById('playersContent');
  if(!snapshot.exists()){ content.innerHTML='<div class="no-data">No players yet</div>'; return; }

  const users = snapshot.val();
  let arr = Object.entries(users).map(function([phone, data]){
    return { phone:phone, name:(data.name||'Unknown'), balance:(data.balance||0), isOnline:!!data.isOnline };
  });
  arr.sort(function(a,b){ return b.balance - a.balance; });

  let html = '';
  arr.forEach(function(u){
    var initials = u.name.charAt(0).toUpperCase();
    var badge    = u.isOnline
      ? '<span class="badge badge-online">â— Online</span>'
      : '<span class="badge badge-offline">â— Offline</span>';
    html +=
      '<div class="player-card">' +
        '<div class="player-left">' +
          '<div class="player-avatar">' + initials + '</div>' +
          '<div>' +
            '<div class="player-name">' + u.name + ' ' + badge + '</div>' +
            '<div class="player-phone">ğŸ“± ' + u.phone + '</div>' +
          '</div>' +
        '</div>' +
        '<div class="player-balance">Rs ' + u.balance.toFixed(0) + '</div>' +
      '</div>';
  });
  content.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  USERS TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderUsers(snapshot){
  const content = document.getElementById('usersContent');
  if(!snapshot.exists()){ content.innerHTML='<div class="no-data">No users yet</div>'; return; }

  const users = snapshot.val();
  let html = '';

  Object.keys(users).forEach(function(phone){
    var u = users[phone];
    var safeName = (u.name || 'Unknown').replace(/'/g, "\\'");

    var badge = u.isOnline
      ? '<span class="badge badge-online">â— Online</span>'
      : '<span class="badge badge-offline">â— Offline</span>';
    
    var bannedBadge = u.banned 
      ? '<span class="badge badge-rejected" style="margin-left:8px;">ğŸš« BANNED</span>'
      : '';

    var devInfo = u.deviceId
      ? '<div class="card-info">ğŸ“± Device: ' + u.deviceId.substring(0,20) + 'â€¦</div>'
      : '<div class="card-info">ğŸ“± Device: N/A</div>';

    var loginInfo = u.lastLogin
      ? '<div class="card-info">ğŸ•’ Last Login: ' + new Date(u.lastLogin).toLocaleString() + '</div>'
      : '';

    var kickBtn = u.isOnline && !u.banned
      ? '<button class="btn-action btn-kick" onclick="kickUser(\'' + phone + '\')">âš¡ Kick</button>'
      : '';
      
    var banBtn = !u.banned
      ? '<button class="btn-action btn-delete" onclick="banUser(\'' + phone + '\')">ğŸš« Ban</button>'
      : '';

    html +=
      '<div class="card">' +
        '<div class="card-header">' +
          '<div>' +
            '<div class="card-title">' + (u.name||'Unknown') + ' ' + badge + bannedBadge + '</div>' +
            '<div class="card-info">ğŸ“± ' + phone + '</div>' +
            devInfo + loginInfo +
          '</div>' +
          '<div class="btn-row">' +
            '<button class="btn-action btn-edit" onclick="editBalance(\'' + phone + '\',\'' + safeName + '\',' + (u.balance||0) + ')">âœï¸ Edit</button>' +
            kickBtn +
            banBtn +
            '<button class="btn-action btn-delete" onclick="deleteUser(\'' + phone + '\')">ğŸ—‘ Delete</button>' +
          '</div>' +
        '</div>' +
        '<div class="card-amount">Rs ' + (u.balance||0).toFixed(0) + '</div>' +
        '<div class="card-info">' +
          'ğŸ’° Deposited: Rs ' + (u.totalDeposit||0).toFixed(0) + ' &nbsp;|&nbsp; ' +
          'ğŸ’¸ Withdrawn: Rs ' + (u.totalWithdraw||0).toFixed(0) +
        '</div>' +
      '</div>';
  });
  content.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KICK USER (Permanent Ban)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function kickUser(phone){
  if(!confirm('âš ï¸ PERMANENTLY KICK user ' + phone + '? They will be banned from all devices!')) return;
  try {
    await banUser(phone);
  } catch(e){ 
    console.error(e); 
    alert('âŒ Error kicking user: ' + e.message); 
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BAN USER (Permanent)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function banUser(phone){
  if(!confirm('âš ï¸ PERMANENTLY BAN user ' + phone + '? They will never be able to login again!')) return;
  
  try {
    // Get user data
    const userSnap = await db.ref('users/' + phone).once('value');
    if(!userSnap.exists()){ 
      alert('User not found!'); 
      return; 
    }
    
    const userData = userSnap.val();
    const namePairKey = userData.name ? `${userData.name}_${phone}` : null;
    
    const updates = {};
    
    // Ban the user
    updates[`users/${phone}/banned`] = true;
    updates[`users/${phone}/isOnline`] = false;
    updates[`users/${phone}/deviceId`] = null;
    updates[`users/${phone}/bannedAt`] = Date.now();
    
    // Add to permanent banned phones list
    updates[`bannedPhones/${phone}`] = {
      banned: true,
      bannedAt: Date.now(),
      name: userData.name || 'Unknown',
      bannedBy: 'admin'
    };
    
    // Remove from device tracking
    if(userData.deviceId){
      updates[`deviceTracking/${userData.deviceId}/users/${phone}`] = null;
    }
    
    // Lock the name-phone pair permanently
    if(namePairKey){
      updates[`namePhonePairs/${namePairKey}/banned`] = true;
      updates[`namePhonePairs/${namePairKey}/bannedAt`] = Date.now();
    }
    
    await db.ref().update(updates);
    
    alert('âœ… User permanently banned! Phone number: ' + phone + ' can never login again.');
  } catch(e){ 
    console.error(e); 
    alert('âŒ Error: ' + e.message); 
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DELETE USER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function deleteUser(phone){
  if(!confirm('âš ï¸ DELETE user ' + phone + '? This will:\n- Remove all user data\n- Delete deposit/withdrawal history\n- Cannot be undone!')) return;
  if(!confirm('Final confirmation - DELETE ' + phone + '?')) return;
  
  try {
    // Get user data first
    const userSnap = await db.ref('users/' + phone).once('value');
    if(!userSnap.exists()){
      alert('User not found!');
      return;
    }
    
    const userData = userSnap.val();
    const namePairKey = userData.name ? `${userData.name}_${phone}` : null;
    
    const updates = {};
    
    // Delete user
    updates[`users/${phone}`] = null;
    
    // Delete from device tracking
    if(userData.deviceId){
      updates[`deviceTracking/${userData.deviceId}/users/${phone}`] = null;
    }
    
    // Delete name-phone pair lock
    if(namePairKey){
      updates[`namePhonePairs/${namePairKey}`] = null;
    }
    
    // Delete all deposit requests from this user
    const depositsSnap = await db.ref('depositRequests').once('value');
    if(depositsSnap.exists()){
      depositsSnap.forEach(child => {
        if(child.val().phone === phone){
          updates[`depositRequests/${child.key}`] = null;
        }
      });
    }
    
    // Delete all withdrawal requests from this user
    const withdrawsSnap = await db.ref('withdrawRequests').once('value');
    if(withdrawsSnap.exists()){
      withdrawsSnap.forEach(child => {
        if(child.val().phone === phone){
          updates[`withdrawRequests/${child.key}`] = null;
        }
      });
    }
    
    await db.ref().update(updates);
    
    alert('âœ… User and all related data deleted!');
    
  } catch(e){
    console.error(e);
    alert('âŒ Error: ' + e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RESET STATISTICS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function resetStats(){
  if(!confirm('âš ï¸ Reset ALL statistics? This will clear:\n- Total deposits\n- Total withdrawals\n\nUser balances will NOT be affected.')) return;
  if(!confirm('Are you absolutely sure? This cannot be undone!')) return;
  
  try {
    const usersSnap = await db.ref('users').once('value');
    const updates = {};
    
    if(usersSnap.exists()){
      usersSnap.forEach(child => {
        const phone = child.key;
        updates[`users/${phone}/totalDeposit`] = 0;
        updates[`users/${phone}/totalWithdraw`] = 0;
      });
    }
    
    await db.ref().update(updates);
    
    alert('âœ… Statistics reset successfully!');
    fetchAndUpdateStats();
    
  } catch(e){
    console.error(e);
    alert('âŒ Error: ' + e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEPOSITS TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDeposits(snapshot){
  const content = document.getElementById('depositsContent');
  if(!snapshot.exists()){ content.innerHTML='<div class="no-data">No deposit requests yet</div>'; return; }

  var arr = [];
  snapshot.forEach(function(child){ arr.push({ firebaseKey:child.key, ...child.val() }); });
  arr.sort(function(a,b){ return (b.timestamp||0) - (a.timestamp||0); });

  var html = '';
  arr.forEach(function(d){
    var date  = d.timestamp ? new Date(d.timestamp).toLocaleString() : 'N/A';
    var badge = d.status==='pending'  ? 'badge-pending'
              : d.status==='approved' ? 'badge-approved' : 'badge-rejected';
    var btns  = d.status==='pending'
      ? '<button class="btn-action btn-approve" onclick="approveDeposit(\'' + d.firebaseKey + '\',\'' + d.phone + '\',' + d.amount + ')">âœ“ Approve</button>' +
        '<button class="btn-action btn-reject"  onclick="rejectDeposit(\'' + d.firebaseKey + '\')">âœ— Reject</button>'
      : '<button class="btn-action btn-delete"  onclick="deleteDeposit(\'' + d.firebaseKey + '\')">ğŸ—‘ Delete</button>';

    html +=
      '<div class="card">' +
        '<div class="card-header">' +
          '<div>' +
            '<div class="card-title">' + (d.name||'Unknown') + '</div>' +
            '<div class="card-info">ğŸ“± ' + d.phone + '</div>' +
            '<div class="card-info">ğŸ•’ ' + date + '</div>' +
          '</div>' +
          '<span class="badge ' + badge + '">' + (d.status||'pending').toUpperCase() + '</span>' +
        '</div>' +
        '<div class="card-amount amount-green">+ Rs ' + d.amount + '</div>' +
        '<div class="btn-row">' + btns + '</div>' +
      '</div>';
  });
  content.innerHTML = html;

  // refresh stats after deposit list changes
  fetchAndUpdateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WITHDRAWALS TAB
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderWithdraws(snapshot){
  const content = document.getElementById('withdrawsContent');
  if(!snapshot.exists()){ content.innerHTML='<div class="no-data">No withdrawal requests yet</div>'; return; }

  var arr = [];
  snapshot.forEach(function(child){ arr.push({ firebaseKey:child.key, ...child.val() }); });
  arr.sort(function(a,b){ return (b.timestamp||0) - (a.timestamp||0); });

  var html = '';
  arr.forEach(function(w){
    var date   = w.timestamp ? new Date(w.timestamp).toLocaleString() : 'N/A';
    var badge  = w.status==='pending'  ? 'badge-pending'
               : w.status==='approved' ? 'badge-approved' : 'badge-rejected';
    var method = w.withdrawMethod==='easy' ? 'Easypaisa' : 'JazzCash';
    var btns   = w.status==='pending'
      ? '<button class="btn-action btn-approve" onclick="approveWithdraw(\'' + w.firebaseKey + '\',\'' + w.phone + '\',' + w.amount + ')">âœ“ Approve</button>' +
        '<button class="btn-action btn-reject"  onclick="rejectWithdraw(\'' + w.firebaseKey + '\')">âœ— Reject</button>'
      : '<button class="btn-action btn-delete"  onclick="deleteWithdraw(\'' + w.firebaseKey + '\')">ğŸ—‘ Delete</button>';

    html +=
      '<div class="card">' +
        '<div class="card-header">' +
          '<div>' +
            '<div class="card-title">' + (w.name||'Unknown') + '</div>' +
            '<div class="card-info">ğŸ“± ' + w.phone + '</div>' +
            '<div class="card-info">ğŸ’³ ' + method + ': ' + w.jazzCash + '</div>' +
            '<div class="card-info">ğŸ•’ ' + date + '</div>' +
          '</div>' +
          '<span class="badge ' + badge + '">' + (w.status||'pending').toUpperCase() + '</span>' +
        '</div>' +
        '<div class="card-amount amount-rose">âˆ’ Rs ' + w.amount + '</div>' +
        '<div class="btn-row">' + btns + '</div>' +
      '</div>';
  });
  content.innerHTML = html;

  // refresh stats
  fetchAndUpdateStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEPOSIT ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function approveDeposit(key, phone, amount){
  if(!confirm('Approve this deposit? Balance will be credited.')) return;
  try {
    var snap = await db.ref('users/' + phone).once('value');
    if(snap.exists()){
      var u = snap.val();
      await db.ref('users/' + phone).update({
        balance:      (u.balance||0) + amount,
        totalDeposit: (u.totalDeposit||0) + amount
      });
    }
    await db.ref('depositRequests/' + key).update({ status:'approved', approvedAt:Date.now() });
    alert('âœ… Deposit approved!');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function rejectDeposit(key){
  if(!confirm('Reject this deposit?')) return;
  try {
    await db.ref('depositRequests/' + key).update({ status:'rejected' });
    alert('Deposit rejected');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function deleteDeposit(key){
  if(!confirm('Delete this deposit request?')) return;
  try {
    await db.ref('depositRequests/' + key).remove();
    alert('âœ… Deleted!');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  WITHDRAWAL ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function approveWithdraw(key, phone, amount){
  if(!confirm('Step 1: Have you sent the money to the user?')) return;
  if(!confirm('Step 2: Confirm approval?')) return;
  try {
    var snap = await db.ref('users/' + phone).once('value');
    if(snap.exists()){
      var u = snap.val();
      await db.ref('users/' + phone).update({
        balance:       Math.max(0, (u.balance||0) - amount),
        totalWithdraw: (u.totalWithdraw||0) + amount
      });
    }
    await db.ref('withdrawRequests/' + key).update({ status:'approved', approvedAt:Date.now() });
    alert('âœ… Withdrawal approved!');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function rejectWithdraw(key){
  if(!confirm('Reject this withdrawal?')) return;
  try {
    await db.ref('withdrawRequests/' + key).update({ status:'rejected' });
    alert('Withdrawal rejected');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function deleteWithdraw(key){
  if(!confirm('Delete this withdrawal request?')) return;
  try {
    await db.ref('withdrawRequests/' + key).remove();
    alert('âœ… Deleted!');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EDIT BALANCE MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function editBalance(phone, name, balance){
  currentEditUser = phone;
  document.getElementById('editUserName').textContent       = name;
  document.getElementById('editUserPhone').textContent      = phone;
  document.getElementById('editCurrentBalance').textContent = 'Rs ' + Number(balance).toFixed(0);
  document.getElementById('editNewBalance').value           = Number(balance).toFixed(0);
  document.getElementById('editBalanceModal').classList.add('active');
}

async function saveBalance(){
  var val = parseFloat(document.getElementById('editNewBalance').value);
  if(isNaN(val) || val < 0){ alert('Invalid balance!'); return; }
  try {
    await db.ref('users/' + currentEditUser).update({ balance: val });
    alert('âœ… Balance updated!');
    closeModal();
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

function closeModal(){
  document.getElementById('editBalanceModal').classList.remove('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TAB SWITCHING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(tabName, btn){
  document.querySelectorAll('.tab').forEach(function(t){ t.classList.remove('active'); });
  document.querySelectorAll('.tab-content').forEach(function(c){ c.classList.remove('active'); });
  btn.classList.add('active');
  document.getElementById(tabName).classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DEPOSIT ADMIN ACTIONS (Simple Like Withdraw)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

async function approveDeposit(key, phone, amount){
  if(!confirm('Approve this deposit?\nBalance will be added: Rs ' + amount)) return;
  
  try {
    // Update request
    await db.ref('depositRequests/' + key).update({ 
      status: 'approved',
      approvedAt: Date.now() 
    });
    
    // Get user
    var userSnap = await db.ref('users/' + phone).once('value');
    if(!userSnap.exists()){ alert('âœ… Approved but user not found'); return; }
    
    var user = userSnap.val();
    
    // Add balance and reset rejections
    await db.ref('users/' + phone).update({
      balance: (user.balance || 0) + amount,
      totalDeposit: (user.totalDeposit || 0) + amount,
      depositRejections: 0,
      depositLockUntil: null
    });
    
    alert('âœ… Deposit approved!\nBalance added: Rs ' + amount);
    
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function rejectDeposit(key, phone){
  if(!confirm('Reject this deposit?\nRejection counter will increase.')) return;
  
  try {
    // Update request
    await db.ref('depositRequests/' + key).update({ 
      status: 'rejected',
      rejectedAt: Date.now() 
    });
    
    // Get user
    var userSnap = await db.ref('users/' + phone).once('value');
    if(!userSnap.exists()){ alert('âœ… Rejected'); return; }
    
    var user = userSnap.val();
    var rejections = (user.depositRejections || 0) + 1;
    var updates = { depositRejections: rejections };
    
    // Lock if 3 rejections
    if(rejections >= 3){
      updates.depositLockUntil = Date.now() + (30 * 60 * 1000);
      alert('âœ… Deposit rejected\nâš ï¸ User locked for 30 minutes (3 rejections)');
    } else {
      alert('âœ… Deposit rejected\nRejections: ' + rejections + '/3');
    }
    
    await db.ref('users/' + phone).update(updates);
    
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}

async function deleteDeposit(key){
  if(!confirm('Delete this deposit?')) return;
  try {
    await db.ref('depositRequests/' + key).remove();
    alert('âœ… Deleted');
  } catch(e){ console.error(e); alert('âŒ Error: ' + e.message); }
}


</script>

</body>
</html>
